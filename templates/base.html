{% load static %}
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}‰ø∫„ÅÆ„Ç¢„Éó„É™{% endblock %}</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    
    <style>
    /* „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥„ÅÆ„Éà„É©„É≥„Ç∏„Ç∑„Éß„É≥ */
    .navbar {
        transition: transform 0.3s ease-in-out;
    }

    /* Èö†„Çå„ÅüÁä∂ÊÖã„ÅÆ„Çπ„Çø„Ç§„É´ */
    .navbar.hidden {
        transform: translateY(-100%);
    }
    
    /* „Çµ„Ç§„Éê„Éº„Éë„É≥„ÇØÈ¢®„ÅÆ„Ç¢„É©„Éº„Éà */
    .cyber-alert {
        background-color: rgba(20, 30, 50, 0.8);
        border: 1px solid rgba(0, 255, 255, 0.3);
        color: #ffffff;
        box-shadow: 0 0 15px rgba(0, 123, 255, 0.3);
    }
    .cyber-alert.alert-success {
        border-color: rgba(0, 255, 159, 0.6);
        box-shadow: 0 0 15px rgba(0, 255, 159, 0.3);
    }
    .cyber-alert.alert-error, .cyber-alert.alert-danger {
        border-color: rgba(255, 80, 80, 0.6);
        box-shadow: 0 0 15px rgba(255, 80, 80, 0.3);
    }
    .cyber-alert.alert-warning {
        border-color: rgba(255, 193, 7, 0.6);
        box-shadow: 0 0 15px rgba(255, 193, 7, 0.3);
    }
    .cyber-alert.alert-info {
        border-color: rgba(0, 255, 255, 0.6);
        box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
    }
    .cyber-alert .btn-close {
        filter: invert(1) brightness(1.5);
    }
    
    /* ÈÄöÁü•„ÇØ„É™„Ç¢„Éú„Çø„É≥ */
    .btn-cyber-secondary {
        background: rgba(100, 100, 100, 0.5);
        color: #ffffff;
        border: 1px solid rgba(200, 200, 200, 0.5);
        transition: all 0.3s ease;
        font-weight: bold;
    }
    
    .btn-cyber-secondary:hover {
        background: rgba(120, 120, 120, 0.6);
        color: #ffffff;
        box-shadow: 0 0 15px rgba(200, 200, 200, 0.5);
        transform: translateY(-2px);
    }
    
    /* „ÉÅ„É£„ÉÉ„ÉàÈÄöÁü•„Çπ„Çø„Ç§„É´ */
    .cyber-toast {
        background: rgba(20, 30, 50, 0.9);
        border: 1px solid rgba(0, 255, 255, 0.6);
        box-shadow: 0 0 15px rgba(0, 255, 255, 0.4);
        margin-bottom: 10px;
    }
    
    .cyber-toast .toast-body {
        color: #ffffff;
    }
    
    .cyber-toast .btn-close {
        filter: invert(1) brightness(1.5);
    }
    
    .cyber-toast.bg-success {
        border-color: rgba(0, 255, 159, 0.6);
        box-shadow: 0 0 15px rgba(0, 255, 159, 0.3);
    }
    
    .cyber-toast.bg-danger {
        border-color: rgba(255, 80, 80, 0.6);
        box-shadow: 0 0 15px rgba(255, 80, 80, 0.3);
    }
    
    .cyber-toast.bg-warning {
        border-color: rgba(255, 193, 7, 0.6);
        box-shadow: 0 0 15px rgba(255, 193, 7, 0.3);
    }
    
    .cyber-toast.bg-info {
        border-color: rgba(0, 255, 255, 0.6);
        box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
    }
    
    .cyber-toast .chat-avatar {
        width: 30px;
        height: 30px;
    }
    
    .cyber-toast .avatar-placeholder {
        width: 30px;
        height: 30px;
        background: linear-gradient(45deg, #2a5298, #1e3c72);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
    }
    
    .cyber-toast .sender-name {
        color: #00ffff;
        text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
    }
    
    /* „ÉÅ„É£„ÉÉ„ÉàÈÄöÁü•„ÅÆ„Éú„Çø„É≥„Çπ„Çø„Ç§„É´ */
    .cyber-toast .btn {
        transition: all 0.3s ease;
        font-size: 0.85rem;
    }
    
    .cyber-toast .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
    }
    
    .cyber-toast .chat-reply-btn:hover {
        background: rgba(0, 255, 255, 0.3) !important;
    }

    .cyber-toast .block-user-btn:hover {
        background: rgba(255, 80, 80, 0.3) !important;
        box-shadow: 0 0 10px rgba(255, 80, 80, 0.3);
    }

    /* Â∑¶‰∏ä„Å´Âõ∫ÂÆö„Åï„Çå„Åüü§ñ„Éú„Çø„É≥„ÅÆ„Çπ„Çø„Ç§„É´ */
    .robot-home-button {
        position: fixed !important;
        top: 20px !important;
        left: 20px !important;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: linear-gradient(135deg, rgba(0, 50, 100, 0.7), rgba(0, 20, 60, 0.8));
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 0 15px rgba(0, 180, 255, 0.7), inset 0 0 10px rgba(0, 245, 255, 0.5);
        border: 2px solid rgba(0, 191, 255, 0.6);
        z-index: 9999 !important;
        transition: all 0.3s ease;
        animation: float 5s ease-in-out infinite;
        overflow: hidden;
        opacity: 1 !important;
        visibility: visible !important;
        cursor: pointer;
    }

    .robot-home-button::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(0, 245, 255, 0.3) 0%, rgba(0, 245, 255, 0) 70%);
        opacity: 0;
        transition: opacity 0.5s ease;
    }

    .robot-home-button::after {
        content: '';
        position: absolute;
        top: -1px;
        left: -1px;
        right: -1px;
        bottom: -1px;
        border-radius: 50%;
        background: linear-gradient(45deg, transparent 40%, rgba(0, 245, 255, 0.8) 45%, rgba(0, 245, 255, 0.8) 55%, transparent 60%);
        background-size: 200% 200%;
        background-position: 0% 0%;
        opacity: 0;
        transition: opacity 0.3s ease;
        animation: borderRotate 3s linear infinite;
        animation-direction: reverse;
    }

    .robot-home-button:hover {
        transform: scale(1.1) rotate(-5deg);
        box-shadow: 0 0 25px rgba(0, 245, 255, 0.9);
        border-color: rgba(0, 245, 255, 0.9);
        animation-play-state: paused;
    }

    .robot-home-button:hover::before {
        opacity: 1;
    }

    .robot-home-button:hover::after {
        opacity: 1;
    }

    .robot-home-button svg {
        filter: drop-shadow(0 0 5px rgba(0, 245, 255, 0.7));
        transition: all 0.3s ease;
    }

    .robot-home-button:hover svg {
        transform: scale(1.1) rotate(5deg);
        filter: drop-shadow(0 0 8px rgba(0, 245, 255, 0.9));
    }

    /* Âè≥‰∏ä„Å´Âõ∫ÂÆö„Åï„Çå„ÅüÈ°î„Ç¢„Ç§„Ç≥„É≥„ÅÆ„Çπ„Çø„Ç§„É´ */
    .profile-button {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: linear-gradient(135deg, rgba(255, 153, 0, 0.7), rgba(204, 85, 0, 0.8));
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 0 15px rgba(255, 153, 0, 0.7);
        border: 2px solid rgba(255, 165, 0, 0.6);
        transition: all 0.3s ease;
        animation: float 3s ease-in-out infinite;
        animation-delay: 0.5s; /* „É≠„Éú„ÉÉ„Éà„Å®„Åö„Çâ„Åô */
        cursor: pointer;
        position: relative;
        overflow: hidden;
    }

    .profile-button::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255, 165, 0, 0.3) 0%, rgba(255, 165, 0, 0) 70%);
        opacity: 0;
        transition: opacity 0.5s ease;
    }

    .profile-button::after {
        content: '';
        position: absolute;
        top: -1px;
        left: -1px;
        right: -1px;
        bottom: -1px;
        border-radius: 50%;
        background: linear-gradient(45deg, transparent 40%, rgba(255, 69, 0, 0.8) 45%, rgba(255, 69, 0, 0.8) 55%, transparent 60%);
        background-size: 200% 200%;
        background-position: 0% 0%;
        opacity: 0;
        transition: opacity 0.3s ease;
        animation: borderRotate 3s linear infinite;
    }

    @keyframes borderRotate {
        0% {
            transform: rotate(0deg);
        }
        100% {
            transform: rotate(360deg);
        }
    }

    .profile-button:hover {
        transform: scale(1.1) rotate(15deg);
        box-shadow: 0 0 25px rgba(255, 69, 0, 0.9);
        border-color: rgba(255, 140, 0, 0.9);
        animation-play-state: paused;
    }

    .profile-button:hover::before {
        opacity: 1;
    }

    .profile-button:hover::after {
        opacity: 1;
    }

    .profile-icon {
        font-size: 1.5rem;
        color: #fff;
        text-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
    }

    .profile-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 50%;
    }

    @keyframes float {
        0% {
            transform: translateY(0px) rotate(0deg);
        }
        25% {
            transform: translateY(-10px) rotate(-5deg);
        }
        50% {
            transform: translateY(0px) rotate(0deg);
        }
        75% {
            transform: translateY(5px) rotate(5deg);
        }
        100% {
            transform: translateY(0px) rotate(0deg);
        }
    }

    .robot-home-button:hover {
        transform: scale(1.1) rotate(-5deg);
        box-shadow: 0 0 25px rgba(0, 245, 255, 0.9);
        border-color: rgba(0, 245, 255, 0.9);
        animation-play-state: paused;
    }

    .robot-home-button:hover::before {
        opacity: 1;
    }

    .robot-home-button:hover::after {
        opacity: 1;
    }

    .robot-home-button svg {
        filter: drop-shadow(0 0 5px rgba(0, 245, 255, 0.7));
        transition: all 0.3s ease;
    }

    .robot-home-button:hover svg {
        transform: scale(1.1) rotate(5deg);
        filter: drop-shadow(0 0 8px rgba(0, 245, 255, 0.9));
    }

    /* „Éó„É≠„Éï„Ç£„Éº„É´„Éú„Çø„É≥„Ç≥„É≥„ÉÜ„Éä„ÅÆ„Çπ„Çø„Ç§„É´ */
    #profile-button-container {
        position: fixed !important;
        top: 20px !important;
        right: 20px !important;
        z-index: 9999 !important;
        opacity: 1 !important;
        visibility: visible !important;
    }

    /* „Éó„É≠„Éï„Ç£„Éº„É´„Çø„Éñ„ÅÆ„Çπ„Çø„Ç§„É´ */
    .profile-tabs {
        position: fixed;
        top: 80px;
        right: 20px;
        width: 250px;
        background: rgba(20, 20, 40, 0.9);
        border: 1px solid rgba(0, 255, 255, 0.3);
        border-radius: 10px;
        box-shadow: 0 0 20px rgba(0, 123, 255, 0.4);
        z-index: 9998;
        display: none;
        overflow: hidden;
        backdrop-filter: blur(10px);
    }

    .profile-tab-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 15px;
        background: rgba(0, 20, 40, 0.7);
        border-bottom: 1px solid rgba(0, 255, 255, 0.3);
    }

    .profile-tab-title {
        color: #00ffff;
        font-weight: bold;
        text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
    }

    .profile-tab-close {
        background: transparent;
        border: none;
        color: #00ffff;
        cursor: pointer;
        font-size: 1.2rem;
        transition: all 0.3s ease;
    }

    .profile-tab-close:hover {
        transform: rotate(90deg);
        color: #ff3366;
    }

    .profile-tab-content {
        max-height: 70vh;
        overflow-y: auto;
    }

    .profile-tab-links {
        display: flex;
        flex-direction: column;
        padding: 10px;
    }

    .profile-tab-link {
        display: flex;
        align-items: center;
        padding: 10px 15px;
        color: #e0e0ff;
        text-decoration: none;
        border-radius: 5px;
        margin-bottom: 5px;
        transition: all 0.3s ease;
    }

    .profile-tab-link i {
        margin-right: 10px;
        width: 20px;
        text-align: center;
        color: #00ffff;
    }

    .profile-tab-link:hover {
        background: rgba(0, 123, 255, 0.2);
        color: #00ffff;
        transform: translateX(5px);
    }

    /* „Ç¢„Ç§„Ç≥„É≥Âà∂Âæ°„Éë„Éç„É´ */
    .icon-control-panel {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: rgba(20, 30, 50, 0.8);
        border: 1px solid rgba(0, 255, 255, 0.3);
        border-radius: 10px;
        padding: 10px;
        z-index: 9998;
        display: block;
        box-shadow: 0 0 15px rgba(0, 123, 255, 0.3);
    }

    .icon-control-panel button {
        background: rgba(0, 123, 255, 0.2);
        color: #00ffff;
        border: 1px solid #00ffff;
        border-radius: 5px;
        padding: 5px 10px;
        margin: 5px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .icon-control-panel button:hover {
        background: rgba(0, 123, 255, 0.4);
        box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        transform: translateY(-2px);
    }

    .hidden-icon {
        opacity: 0 !important;
        visibility: hidden !important;
        pointer-events: none !important;
    }

    /* ‰∏ä‰∏ã„Å´Âãï„Åè„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
    @keyframes moveUpDown {
        0% {
            transform: translateY(0);
        }
        50% {
            transform: translateY(calc(100vh - 120px));
        }
        100% {
            transform: translateY(0);
        }
    }
    
    /* „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„ÇíÈÅ©Áî® */
    .move-up-down {
        animation: moveUpDown 30s linear infinite;
    }
    </style>
</head>
<body style="background-color: #0a0a0a; color: #cccccc;">
    <!-- „É¢„Éº„ÉÄ„É´ËÉåÊôØ„ÅÆÂº∑Âà∂„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó„Çπ„ÇØ„É™„Éó„Éà -->
    <script>
    // ÁîªÈù¢„ÇíÊöó„Åè„Åô„Çã„É¢„Éº„ÉÄ„É´ËÉåÊôØÂïèÈ°å„ÇíËß£Ê±∫„Åô„Çã„Åü„ÇÅ„ÅÆ„Çπ„ÇØ„É™„Éó„Éà
    document.addEventListener('DOMContentLoaded', function() {
        // „Åô„Åπ„Å¶„ÅÆ„É¢„Éº„ÉÄ„É´Èñ¢ÈÄ£Ë¶ÅÁ¥†„ÇíÁõ£Ë¶ñ
        document.addEventListener('click', function(e) {
            // „ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„ÉàÂæå„ÄÅ„Çè„Åö„Åã„Å™ÈÅÖÂª∂„Åß„É¢„Éº„ÉÄ„É´ËÉåÊôØ„Çí„ÉÅ„Çß„ÉÉ„ÇØ
            setTimeout(function() {
                const modalBackdrops = document.querySelectorAll('.modal-backdrop');
                if (modalBackdrops.length > 0 && !document.querySelector('.modal.show')) {
                    console.log('Â≠§Á´ã„Åó„Åü„É¢„Éº„ÉÄ„É´ËÉåÊôØ„ÇíÊ§úÂá∫ - „ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó„Åó„Åæ„Åô');
                    modalBackdrops.forEach(backdrop => {
                        backdrop.classList.remove('show');
                        backdrop.remove();
                    });
                    document.body.classList.remove('modal-open');
                    document.body.style.overflow = '';
                    document.body.style.paddingRight = '';
                }
            }, 300);
        });
        
        // ÂÆöÊúüÁöÑ„Å´„É¢„Éº„ÉÄ„É´ËÉåÊôØ„Çí„ÉÅ„Çß„ÉÉ„ÇØ
        setInterval(function() {
            // „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™„É¢„Éº„ÉÄ„É´„Åå„Å™„ÅÑÂ†¥Âêà„ÅØ„É¢„Éº„ÉÄ„É´ËÉåÊôØ„ÇíÂâäÈô§
            if (!document.querySelector('.modal.show') && document.querySelectorAll('.modal-backdrop').length > 0) {
                console.log('ÂÆöÊúü„ÉÅ„Çß„ÉÉ„ÇØ: Â≠§Á´ã„Åó„Åü„É¢„Éº„ÉÄ„É´ËÉåÊôØ„ÇíÊ§úÂá∫ - „ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó„Åó„Åæ„Åô');
                document.querySelectorAll('.modal-backdrop').forEach(backdrop => {
                    backdrop.classList.remove('show');
                    backdrop.remove();
                });
                document.body.classList.remove('modal-open');
                document.body.style.overflow = '';
                document.body.style.paddingRight = '';
            }
        }, 2000); // 2Áßí„Åî„Å®„Å´„ÉÅ„Çß„ÉÉ„ÇØ
    });
    </script>
    
    {% comment %}
    {% block navbar %}
        {% include 'includes/navbar.html' %}
    {% endblock %}
    {% endcomment %}
    
    <!-- „ÉÅ„É£„ÉÉ„ÉàÈÄöÁü•„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà -->
    <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 9999;" data-unread="0">
        <div id="chatNotification" class="toast align-items-center text-white cyber-toast" role="alert" aria-live="assertive" aria-atomic="true" style="display: none;">
            <div class="d-flex flex-column">
                <div class="toast-body pb-0">
                    <div class="d-flex align-items-center mb-2">
                        <div class="chat-avatar me-2">
                            <div class="avatar-placeholder rounded-circle">
                                <i class="bi bi-person"></i>
                            </div>
                        </div>
                        <div class="chat-message-container" style="display: none;">
                            <strong class="sender-name"></strong>„Åå„ÄÅ„ÉÅ„É£„ÉÉ„Éà„ÅßË©±„Åó„Åã„Åë„Å¶„ÅÑ„Åæ„Åô
                        </div>
                    </div>
                    <div class="mt-2 pt-2 border-top d-flex justify-content-end gap-2 chat-buttons-container" style="display: none;">
                        <button type="button" class="btn btn-sm block-user-btn" style="background: rgba(255, 80, 80, 0.2); color: #ff5050; border: 1px solid #ff5050;">
                            <i class="bi bi-x-circle"></i> ÊãíÁµ∂„Åô„Çã
                        </button>
                        <button type="button" class="btn btn-sm me-2" data-bs-dismiss="toast" style="background: rgba(255, 255, 255, 0.1); color: white;">
                            „ÅÇ„Å®„Åß
                        </button>
                        <button type="button" class="btn btn-sm chat-reply-btn" style="background: rgba(0, 255, 255, 0.2); color: #00ffff; border: 1px solid #00ffff;">
                            Ëøî‰ø°„Åô„Çã
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- „Ç∑„Çπ„ÉÜ„É†„É°„ÉÉ„Çª„Éº„Ç∏Áî®„Éà„Éº„Çπ„Éà -->
        {% if messages %}
            {% for message in messages %}
                {% if "Home„Å´‰øùÂ≠ò„Åó„Åæ„Åó„Åü" not in message|stringformat:"s" %}
                <div class="toast align-items-center text-white cyber-toast show" role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="d-flex">
                        <div class="toast-body">
                            <i class="bi {% if message.tags == 'success' %}bi-check-circle-fill text-success{% elif message.tags == 'error' or message.tags == 'danger' %}bi-exclamation-circle-fill text-danger{% elif message.tags == 'warning' %}bi-exclamation-triangle-fill text-warning{% else %}bi-info-circle-fill text-info{% endif %} me-2"></i>
                            {{ message }}
                        </div>
                        <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                </div>
                {% endif %}
            {% endfor %}
        {% endif %}
    </div>
    
    <!-- ÂÖ•ÂÆ§‚ÜíÈÄÄÂÆ§„É¢„Éº„ÉÄ„É´ -->
    <div class="modal fade" id="enterExitModal" tabindex="-1" aria-labelledby="enterExitModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background-color: rgba(20, 30, 50, 0.9); border: 1px solid rgba(0, 255, 255, 0.3); color: #ffffff;">
                <div class="modal-header" style="border-bottom: 1px solid rgba(0, 255, 255, 0.3);">
                    <h5 class="modal-title" id="enterExitModalLabel">„ÉÅ„É£„ÉÉ„ÉàÁü≠ÊôÇÈñìË®™Âïè„ÅÆÈÄöÁü•</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="d-flex align-items-center mb-3">
                        <div id="ee-avatar" class="me-3" style="width: 48px; height: 48px;">
                            <div class="avatar-placeholder rounded-circle d-flex align-items-center justify-content-center" style="width: 100%; height: 100%; background: linear-gradient(45deg, #2a5298, #1e3c72);">
                                <i class="bi bi-person fs-4"></i>
                            </div>
                        </div>
                        <div>
                            <span id="ee-message" class="fs-5">
                                <strong id="ee-sender-name" style="color: #00ffff; text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);"></strong>„Åï„Çì„Åå„ÄÅ„ÅÇ„Å™„Åü„Å®„ÅÆ„ÉÅ„É£„ÉÉ„Éà„É´„Éº„É†„ÇíÈñã„Åç„Åæ„Åó„Åü„Åå„ÄÅ„Åô„Åß„Å´ÈÄÄÂÆ§„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ
                            </span>
                            <div class="text-muted mt-1 small" id="ee-time"></div>
                        </div>
                    </div>
                    <div class="alert alert-info" style="background: rgba(0, 123, 255, 0.1); border-color: rgba(0, 255, 255, 0.3);">
                        <i class="bi bi-info-circle me-2"></i>Áõ∏Êâã„ÅØ„ÉÅ„É£„ÉÉ„Éà„É´„Éº„É†„ÇíÁü≠ÊôÇÈñì„Å†„ÅëÁ¢∫Ë™ç„Åó„ÅüÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇÂæå„Åß„Åæ„ÅüÈÄ£Áµ°„Åå„ÅÇ„Çã„Åã„ÇÇ„Åó„Çå„Åæ„Åõ„Çì„ÄÇ
                    </div>
                </div>
                <div class="modal-footer" style="border-top: 1px solid rgba(0, 255, 255, 0.3);">
                    <button type="button" class="btn" data-bs-dismiss="modal" style="background: rgba(255, 80, 80, 0.2); color: #ff5050; border: 1px solid #ff5050;">
                        <i class="bi bi-x-circle"></i> ÁÑ°Ë¶ñ„Åô„Çã
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="background: rgba(100, 100, 100, 0.5); border: 1px solid rgba(200, 200, 200, 0.5);">
                        „ÅÇ„Å®„Åß
                    </button>
                    <button type="button" class="btn" id="ee-goto-chat" style="background: rgba(0, 255, 255, 0.2); color: #00ffff; border: 1px solid #00ffff;">
                        „É´„Éº„É†„Å´Ë°å„Åè
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ÂÖ•ÂÆ§„É¢„Éº„ÉÄ„É´ -->
    <div class="modal fade" id="enterModal" tabindex="-1" aria-labelledby="enterModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background-color: rgba(20, 30, 50, 0.9); border: 1px solid rgba(0, 255, 255, 0.3); color: #ffffff;">
                <div class="modal-header" style="border-bottom: 1px solid rgba(0, 255, 255, 0.3);">
                    <h5 class="modal-title" id="enterModalLabel">„ÉÅ„É£„ÉÉ„ÉàË®™Âïè„ÅÆÈÄöÁü•</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="d-flex align-items-center mb-3">
                        <div id="e-avatar" class="me-3" style="width: 48px; height: 48px;">
                            <div class="avatar-placeholder rounded-circle d-flex align-items-center justify-content-center" style="width: 100%; height: 100%; background: linear-gradient(45deg, #2a5298, #1e3c72);">
                                <i class="bi bi-person fs-4"></i>
                            </div>
                        </div>
                        <div>
                            <span id="e-message" class="fs-5">
                                <strong id="e-sender-name" style="color: #00ffff; text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);"></strong>„Åï„Çì„Åå„ÄÅ„ÅÇ„Å™„Åü„Å®„ÅÆ„ÉÅ„É£„ÉÉ„Éà„É´„Éº„É†„ÇíÈñã„Åç„Åæ„Åó„Åü„ÄÇ
                            </span>
                            <div class="text-muted mt-1 small" id="e-time"></div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" style="border-top: 1px solid rgba(0, 255, 255, 0.3);">
                    <button type="button" class="btn" data-bs-dismiss="modal" style="background: rgba(255, 80, 80, 0.2); color: #ff5050; border: 1px solid #ff5050;">
                        <i class="bi bi-x-circle"></i> ÊãíÁµ∂„Åô„Çã
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="background: rgba(100, 100, 100, 0.5); border: 1px solid rgba(200, 200, 200, 0.5);">
                        „ÅÇ„Å®„Åß
                    </button>
                    <button type="button" class="btn" id="e-goto-chat" style="background: rgba(0, 255, 255, 0.2); color: #00ffff; border: 1px solid #00ffff;">
                        „É´„Éº„É†„Å´Ë°å„Åè
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ÈÄÄÂÆ§„É¢„Éº„ÉÄ„É´ -->
    <div class="modal fade" id="exitModal" tabindex="-1" aria-labelledby="exitModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background-color: rgba(20, 30, 50, 0.9); border: 1px solid rgba(255, 80, 80, 0.3); color: #ffffff;">
                <div class="modal-header" style="border-bottom: 1px solid rgba(255, 80, 80, 0.3);">
                    <h5 class="modal-title" id="exitModalLabel">„ÉÅ„É£„ÉÉ„ÉàÈÄÄÂÆ§„ÅÆÈÄöÁü•</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="d-flex align-items-center mb-3">
                        <div id="exit-avatar" class="me-3" style="width: 48px; height: 48px;">
                            <div class="avatar-placeholder rounded-circle d-flex align-items-center justify-content-center" style="width: 100%; height: 100%; background: linear-gradient(45deg, #2a5298, #1e3c72);">
                                <i class="bi bi-person fs-4"></i>
                            </div>
                        </div>
                        <div>
                            <span id="exit-message" class="fs-5">
                                <strong id="exit-sender-name" style="color: #ff7070; text-shadow: 0 0 5px rgba(255, 80, 80, 0.5);"></strong>„Åï„Çì„Åå„ÄÅ„ÉÅ„É£„ÉÉ„Éà„É´„Éº„É†„Åã„ÇâÈÄÄÂÆ§„Åó„Åæ„Åó„Åü„ÄÇ
                            </span>
                            <div class="text-muted mt-1 small" id="exit-time"></div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" style="border-top: 1px solid rgba(255, 80, 80, 0.3);">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="background: rgba(100, 100, 100, 0.5); border: 1px solid rgba(200, 200, 200, 0.5);">
                        Èñâ„Åò„Çã
                    </button>
                    <button type="button" class="btn" id="exit-goto-chat" style="background: rgba(0, 255, 255, 0.2); color: #00ffff; border: 1px solid #00ffff;">
                        „ÉÅ„É£„ÉÉ„Éà„ÇíÁ¢∫Ë™ç„Åô„Çã
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    {% block messages %}
    {% comment %}
    {% if messages %}
    <div class="container mt-3">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="m-0 text-info">ÈÄöÁü•</h5>
            <a href="{% url 'profiles:clear_messages' %}?next={{ request.path }}" class="btn btn-sm btn-cyber-secondary">
                <i class="bi bi-x-circle"></i> ÂÖ®ÈÄöÁü•„ÇíÊ∂àÂéª
            </a>
        </div>
        {% for message in messages %}
            {% if "Home„Å´‰øùÂ≠ò„Åó„Åæ„Åó„Åü" not in message|stringformat:"s" %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show cyber-alert" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            {% endif %}
        {% endfor %}
    </div>
    {% endif %}
    {% endcomment %}
    {% endblock %}
    
    {% block content %}
    {% endblock %}

    <!-- Â∑¶‰∏ä„Å´Âõ∫ÂÆö„Åï„Çå„Åüü§ñ„Éú„Çø„É≥ -->
    <a href="{% url 'home:home' %}" class="robot-home-button" id="robot-home-button">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#00ffff" class="bi bi-house-fill" viewBox="0 0 16 16">
            <path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L8 2.207l6.646 6.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293z"/>
            <path d="m8 3.293 6 6V13.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5V9.293z"/>
        </svg>
    </a>

    <!-- Âè≥‰∏ä„Å´Âõ∫ÂÆö„Åï„Çå„ÅüÈ°î„Ç¢„Ç§„Ç≥„É≥ -->
    {% if user.is_authenticated %}
    <div id="profile-button-container">
        <a href="{% url 'dashboard:index' %}" class="profile-button" data-bs-toggle="tooltip" data-bs-placement="left" title="{{ request.user.username }}">
            {% if request.user.profile.avatar %}
                <img src="{{ request.user.profile.avatar.url }}" alt="{{ request.user.username }}" class="profile-image">
            {% else %}
                <i class="fas fa-user-tie profile-icon"></i>
            {% endif %}
        </a>
    </div>
    {% endif %}

    <!-- „Éó„É≠„Éï„Ç£„Éº„É´„Çø„Éñ -->
    <div class="profile-tabs" id="profile-tabs">
        <div class="profile-tab-header">
            <div class="profile-tab-title">„É°„Éã„É•„Éº</div>
            <button class="profile-tab-close" id="profile-tab-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="profile-tab-content">
            <div class="profile-tab-links">
                <a href="{% url 'home:home' %}" class="profile-tab-link">
                    <i class="fas fa-home"></i> „Éõ„Éº„É†
                </a>
                <a href="{% url 'home:home' %}" class="profile-tab-link">
                    <i class="fas fa-th"></i> „Ç¢„Éó„É™‰∏ÄË¶ß
                </a>
                <a href="{% url 'blogs:post_list' %}" class="profile-tab-link">
                    <i class="fas fa-blog"></i> „Éñ„É≠„Ç∞
                </a>
                {% if user.is_authenticated %}
                <a href="{% url 'dashboard:index' %}" class="profile-tab-link">
                    <i class="fas fa-tachometer-alt"></i> „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ
                </a>
                <a href="{% url 'dashboard:profile' %}" class="profile-tab-link">
                    <i class="fas fa-user-circle"></i> „Éó„É≠„Éï„Ç£„Éº„É´
                </a>
                <a href="{% url 'dashboard:apps' %}" class="profile-tab-link">
                    <i class="fas fa-laptop-code"></i> „Éû„Ç§„Ç¢„Éó„É™
                </a>
                <a href="{% url 'blogs:my_posts' %}" class="profile-tab-link">
                    <i class="fas fa-pencil-alt"></i> „Éû„Ç§„Éñ„É≠„Ç∞
                </a>
                <a href="{% url 'chats:chat_list' %}" class="profile-tab-link">
                    <i class="fas fa-comments"></i> „ÉÅ„É£„ÉÉ„Éà
                </a>
                <a href="{% url 'dashboard:account' %}" class="profile-tab-link">
                    <i class="fas fa-cog"></i> Ë®≠ÂÆö
                </a>
                <a href="{% url 'logout' %}" class="profile-tab-link">
                    <i class="fas fa-sign-out-alt"></i> „É≠„Ç∞„Ç¢„Ç¶„Éà
                </a>
                {% else %}
                <a href="{% url 'login' %}" class="profile-tab-link">
                    <i class="fas fa-sign-in-alt"></i> „É≠„Ç∞„Ç§„É≥
                </a>
                <a href="{% url 'accounts:signup' %}" class="profile-tab-link">
                    <i class="fas fa-user-plus"></i> Êñ∞Ë¶èÁôªÈå≤
                </a>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- „Çπ„ÇØ„É≠„Éº„É´Âà∂Âæ°Áî®„ÅÆ„Çπ„ÇØ„É™„Éó„Éà -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // „Éõ„Éº„É†„Éö„Éº„Ç∏„Åß„ÅÆ„Ç¢„Ç§„Ç≥„É≥„ÅÆ‰ΩçÁΩÆË™øÊï¥
        const isHomePage = window.location.pathname === '/' || window.location.pathname === '/home/';
        const profileButtonContainer = document.getElementById('profile-button-container');
        const robotHomeButton = document.querySelector('.robot-home-button');
        
        // „ÉÑ„Éº„É´„ÉÅ„ÉÉ„Éó„ÅÆÂàùÊúüÂåñ
        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
        
        // „Éà„Éº„Çπ„Éà„ÅÆÂàùÊúüÂåñ
        const toastElList = [].slice.call(document.querySelectorAll('.toast'));
        const toastList = toastElList.map(function(toastEl) {
            const toast = new bootstrap.Toast(toastEl, {
                autohide: true,
                delay: 5000
            });
            toast.show();
            return toast;
        });
        
        if (isHomePage) {
            if (profileButtonContainer) {
                profileButtonContainer.style.top = '60px'; // „Çø„Éñ„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥„ÅÆ‰∏ã„Å´ÈÖçÁΩÆ
            }
            if (robotHomeButton) {
                robotHomeButton.style.top = '60px'; // „Çø„Éñ„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥„ÅÆ‰∏ã„Å´ÈÖçÁΩÆ
            }
        }
        
        // „Çπ„ÇØ„É≠„Éº„É´ÊôÇ„ÇÇ„Ç¢„Ç§„Ç≥„É≥„ÇíÂ∏∏„Å´Ë°®Á§∫Ôºà„Çπ„ÇØ„É≠„Éº„É´„Ç§„Éô„É≥„Éà„Åß„ÅØ„Å™„Åè„ÄÅÁõ¥Êé•„Çπ„Çø„Ç§„É´„ÇíË®≠ÂÆöÔºâ
        if (robotHomeButton) {
            robotHomeButton.style.opacity = '1';
            robotHomeButton.style.visibility = 'visible';
            robotHomeButton.style.position = 'fixed'; // Âõ∫ÂÆö‰ΩçÁΩÆ„ÇíÁ¢∫‰øù
        }
        
        if (profileButtonContainer) {
            profileButtonContainer.style.opacity = '1';
            profileButtonContainer.style.visibility = 'visible';
            profileButtonContainer.style.position = 'fixed'; // Âõ∫ÂÆö‰ΩçÁΩÆ„ÇíÁ¢∫‰øù
        }
        
        // „Çπ„ÇØ„É≠„Éº„É´„Ç§„Éô„É≥„Éà„Åß„ÇÇÂ∏∏„Å´Ë°®Á§∫„ÇíÁ¢∫‰øù
        window.addEventListener('scroll', function() {
            if (robotHomeButton) {
                robotHomeButton.style.opacity = '1';
                robotHomeButton.style.visibility = 'visible';
            }
            
            if (profileButtonContainer) {
                profileButtonContainer.style.opacity = '1';
                profileButtonContainer.style.visibility = 'visible';
            }
        });
        
        // „Éú„Çø„É≥„Çí‰∏ä‰∏ã„Å´Âãï„Åã„ÅôÈñ¢Êï∞
        function moveButtonsUpDown() {
            // ÂàùÊúü‰ΩçÁΩÆ„ÇíÂèñÂæó
            let startPositionRobot = parseInt(robotHomeButton?.style.top) || 20;
            let startPositionProfile = parseInt(profileButtonContainer?.style.top) || 20;
            
            // ÁîªÈù¢„ÅÆÈ´ò„Åï„ÇíÂèñÂæó
            const windowHeight = window.innerHeight;
            // ÁîªÈù¢‰∏ãÈÉ®„ÅÆ‰ΩçÁΩÆ
            const bottomPosition = windowHeight - 70;
            
            console.log("ÁîªÈù¢„ÅÆÈ´ò„Åï: " + windowHeight);
            console.log("ÈñãÂßã‰ΩçÁΩÆ: " + startPositionRobot);
            console.log("ÁµÇ‰∫Ü‰ΩçÁΩÆ: " + bottomPosition);
            
            // Êó¢Â≠ò„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„ÇíÁÑ°ÂäπÂåñ
            if (robotHomeButton) {
                robotHomeButton.style.animation = 'none';
                robotHomeButton.style.transition = 'none';
                // float„ÇØ„É©„Çπ„ÇíÂâäÈô§
                robotHomeButton.classList.remove('float');
            }
            
            if (profileButtonContainer) {
                profileButtonContainer.style.animation = 'none';
                profileButtonContainer.style.transition = 'none';
                // float„ÇØ„É©„Çπ„ÇíÂâäÈô§
                const profileButton = profileButtonContainer.querySelector('.profile-button');
                if (profileButton) {
                    profileButton.style.animation = 'none';
                    profileButton.style.transition = 'none';
                    profileButton.classList.remove('float');
                }
            }
            
            // ÁèæÂú®„ÅÆ‰ΩçÁΩÆÔºàtranslateY„ÅÆÂÄ§Ôºâ
            let currentTranslateY = 0;
            
            // ÁßªÂãïÊñπÂêëÔºà1: ‰∏ã„Å´ÁßªÂãï„ÄÅ-1: ‰∏ä„Å´ÁßªÂãïÔºâ
            let direction = 1;
            
            // ÁßªÂãïÈÄüÂ∫¶Ôºà„Éî„ÇØ„Çª„É´/„Ç§„É≥„Çø„Éº„Éê„É´Ôºâ
            const step = 0.5; // 0.5„Éî„ÇØ„Çª„É´„Åö„Å§ÁßªÂãïÔºà„Çà„ÇäÂ∞è„Åï„ÅèÔºâ
            
            // ÊúÄÂ§ßÁßªÂãïË∑ùÈõ¢
            const maxTranslateY = bottomPosition - startPositionRobot;
            
            // ‰ΩçÁΩÆ„ÇíÊõ¥Êñ∞„Åô„ÇãÈñ¢Êï∞
            const moveInterval = setInterval(function() {
                // ‰ΩçÁΩÆ„ÇíÊõ¥Êñ∞
                currentTranslateY += step * direction;
                
                // ÊñπÂêë„ÇíÂ§âÊõ¥
                if (direction === 1 && currentTranslateY >= maxTranslateY) {
                    direction = -1;
                    console.log("‰∏ã„Å´Âà∞ÈÅî: " + currentTranslateY);
                } else if (direction === -1 && currentTranslateY <= 0) {
                    direction = 1;
                    console.log("‰∏ä„Å´Âà∞ÈÅî: " + currentTranslateY);
                }
                
                // Â∑¶Âè≥„ÅÆÊè∫„Çå„ÇíË®àÁÆóÔºà„Çµ„Ç§„É≥Ê≥¢„Çí‰ΩøÁî®Ôºâ
                const swayAmount = Math.sin(currentTranslateY / 30) * 5; // 5„Éî„ÇØ„Çª„É´„ÅÆÊåØÂπÖ„ÅßÊè∫„Çå„ÇãÔºàÂ∞è„Åï„ÅèÔºâ
                
                // ÂõûËª¢„ÇíË®àÁÆóÔºà„Çµ„Ç§„É≥Ê≥¢„Çí‰ΩøÁî®Ôºâ
                const rotateAmount = Math.sin(currentTranslateY / 50) * 3; // 3Â∫¶„ÅÆÊåØÂπÖ„ÅßÂõûËª¢ÔºàÂ∞è„Åï„ÅèÔºâ
                
                // ‰ΩçÁΩÆ„ÇíÈÅ©Áî®Ôºàtransform„Çí‰ΩøÁî®Ôºâ- ‰∏ä‰∏ã„ÅÆÁßªÂãï„Å®Â∑¶Âè≥„ÅÆÊè∫„Çå„ÇíÁµÑ„ÅøÂêà„Çè„Åõ„Çã
                if (robotHomeButton) {
                    robotHomeButton.style.transform = `translateY(${currentTranslateY}px) translateX(${swayAmount}px) rotate(${rotateAmount}deg)`;
                }
                
                if (profileButtonContainer) {
                    profileButtonContainer.style.transform = `translateY(${currentTranslateY}px) translateX(${swayAmount}px) rotate(${rotateAmount}deg)`;
                }
                
                // ÁèæÂú®„ÅÆ‰ΩçÁΩÆ„Çí„É≠„Ç∞„Å´Âá∫ÂäõÔºà„Éá„Éê„ÉÉ„Ç∞Áî®Ôºâ
                if (currentTranslateY % 50 === 0) {
                    console.log("ÁèæÂú®‰ΩçÁΩÆ: " + currentTranslateY + ", Êè∫„Çå: " + swayAmount + ", ÂõûËª¢: " + rotateAmount);
                }
            }, 200); // 200„Éü„É™Áßí„Åî„Å®„Å´Êõ¥Êñ∞Ôºà„Çà„ÇäÈÅÖ„ÅèÔºâ
        }
        
        // „Éú„Çø„É≥„ÅÆÁßªÂãï„ÇíÈñãÂßã
        moveButtonsUpDown();
        
        let lastScrollTop = 0;
        const navbarElement = document.querySelector('.navbar');
        
        if (navbarElement) {  // navbar„ÅåÂ≠òÂú®„Åô„ÇãÂ†¥Âêà„ÅÆ„ÅøÂÆüË°å
            window.addEventListener('scroll', function() {
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                const isScrollingUp = scrollTop < lastScrollTop;
                
                if (scrollTop > 100 && !isScrollingUp) {
                    navbarElement.classList.add('hidden');
                } else {
                    navbarElement.classList.remove('hidden');
                }
                
                lastScrollTop = scrollTop;
            });
        }
    });
    </script>

    {% if user.is_authenticated %}
    <!-- „ÉÅ„É£„ÉÉ„ÉàÈÄöÁü•„Çπ„ÇØ„É™„Éó„Éà -->
    <script>
    // „É¢„Éº„ÉÄ„É´ËÉåÊôØ„ÇíÂâäÈô§„Åô„Çã„É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£Èñ¢Êï∞Ôºà„Ç∞„É≠„Éº„Éê„É´Èñ¢Êï∞Ôºâ
    function cleanupModalBackdrops() {
        // „Åô„Åπ„Å¶„ÅÆ„É¢„Éº„ÉÄ„É´ËÉåÊôØ„ÇíÊ§úÁ¥¢„Åó„Å¶ÂâäÈô§
        const existingBackdrops = document.querySelectorAll('.modal-backdrop');
        existingBackdrops.forEach(backdrop => {
            // „ÇØ„É©„Çπ„ÇíÂâäÈô§„Åó„Å¶„Éï„Çß„Éº„Éâ„Ç¢„Ç¶„Éà
            backdrop.classList.remove('show');
            backdrop.classList.add('removing');
            
            // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÁµÇ‰∫Ü„ÇíÂæÖ„Å£„Å¶„Åã„ÇâÂâäÈô§
            setTimeout(() => {
                try {
                    if (backdrop && document.body.contains(backdrop)) {
                        backdrop.remove();
                    }
                } catch (e) {
                    console.error('„É¢„Éº„ÉÄ„É´ËÉåÊôØÂâäÈô§„Ç®„É©„Éº:', e);
                }
            }, 300);
        });
        
        if (existingBackdrops.length > 0) {
            console.log(`„É¢„Éº„ÉÄ„É´ËÉåÊôØ„Çí„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó„Åó„Åæ„Åó„Åü (${existingBackdrops.length}ÂÄã)`);
        }
        
        // body„Åã„Çâ„É¢„Éº„ÉÄ„É´Èñ¢ÈÄ£„ÅÆ„ÇØ„É©„Çπ„Å®„Çπ„Çø„Ç§„É´„ÇíÂâäÈô§
        document.body.classList.remove('modal-open');
        document.body.style.overflow = '';
        document.body.style.paddingRight = '';
        
        // Ë™§„Å£„Å¶„É¢„Éº„ÉÄ„É´„ÅÆ„Éï„Çß„Éº„Éâ„Ç®„Éï„Çß„ÇØ„Éà„ÅåÊÆã„Å£„Å¶„ÅÑ„ÇãÂ†¥Âêà„Å´ÂØæÂá¶
        document.querySelectorAll('.modal-fade').forEach(el => el.remove());
        
        // „Åô„Åπ„Å¶„ÅÆ„É¢„Éº„ÉÄ„É´„ÇíÁ¢∫Ë™ç„Åó„ÄÅË°®Á§∫„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ„ÇÇ„ÅÆ„ÅØhidden„Ç§„Éô„É≥„Éà„ÇíÂº∑Âà∂ÁöÑ„Å´Áô∫ÁÅ´
        document.querySelectorAll('.modal:not(.show)').forEach(modal => {
            const modalInstance = bootstrap.Modal.getInstance(modal);
            if (modalInstance) {
                modal.dispatchEvent(new Event('hidden.bs.modal'));
            }
        });
    }
    
    document.addEventListener('DOMContentLoaded', function() {
        // „Éö„Éº„Ç∏„É≠„Éº„ÉâÊôÇ„Å´„É¢„Éº„ÉÄ„É´ËÉåÊôØ„Çí„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
        cleanupModalBackdrops();
        
        // „ÉÅ„É£„ÉÉ„ÉàË©≥Á¥∞ÁîªÈù¢„ÅßË®≠ÂÆö„Åï„Çå„ÇãÈÄöÁü•ÁÑ°ÂäπÂåñ„Éï„É©„Ç∞„Çí„ÉÅ„Çß„ÉÉ„ÇØ
        if (window.disableAllChatNotifications === true) {
            console.log('‚ö†Ô∏è „ÉÅ„É£„ÉÉ„ÉàË©≥Á¥∞ÁîªÈù¢„ÅÆ„Åü„ÇÅ„ÄÅÈÄÅ‰ø°ËÄÖÈÄöÁü•Ê©üËÉΩ„ÇíÂÆåÂÖ®„Å´„Çπ„Ç≠„ÉÉ„Éó„Åó„Åæ„Åô');
            // „Åì„ÅÆ„ÉÅ„É£„ÉÉ„Éà„Å∏„ÅÆÈÄöÁü•„ÅÆ„Åø„Çπ„Ç≠„ÉÉ„Éó„Åô„Çã„Çà„ÅÜ„Å´„Åó„ÄÅÂÆåÂÖ®„Å´ÈÄöÁü•Ê©üËÉΩ„ÇíÁÑ°ÂäπÂåñ„Åó„Å™„ÅÑ
            // return; // „Åì„ÅÆ„Çπ„ÇØ„É™„Éó„Éà„ÅÆÂÆüË°å„ÇíÁµÇ‰∫Ü - ÂâäÈô§
        }
        
        // „É¶„Éº„Ç∂„ÉºID„ÇíÂÖà„Å´ÂèñÂæóÔºà„Ç∞„É≠„Éº„Éê„É´„Çπ„Ç≥„Éº„Éó„Åß‰ΩøÁî®„Åß„Åç„Çã„Çà„ÅÜ„Å´Ôºâ
        const myUserId = "{{ request.user.id }}";
        console.log('ÁèæÂú®„ÅÆ„É¶„Éº„Ç∂„ÉºID:', myUserId);
        
        // ÁèæÂú®„ÅÆURL„ÇíÂèñÂæó
        const currentPath = window.location.pathname;
        console.log('ÁèæÂú®„ÅÆURL:', currentPath);
        
        // „ÉÅ„É£„ÉÉ„ÉàÈñ¢ÈÄ£„Éö„Éº„Ç∏„Å´„ÅÑ„Çã„Åã„Å©„ÅÜ„Åã„ÅÆÂà§ÂÆö„ÇíÂº∑ÂåñÔºànew/„ÇÇÂê´„ÇÅ„ÇãÔºâ
        const isOnChatPage = currentPath.includes('/chats/');
        
        // „Éö„Éº„Ç∏„É≠„Éº„ÉâÊôÇ„Å´ÂøÖ„ÅöÂÖ®„Å¶„ÅÆ„Éà„Éº„Çπ„ÉàÈÄöÁü•„ÇíÁÑ°ÂäπÂåñÔºàÁâπ„Å´„ÉÅ„É£„ÉÉ„Éà„Éö„Éº„Ç∏„Åß„ÅØÔºâ
        if (isOnChatPage) {
            console.log('„ÉÅ„É£„ÉÉ„Éà„Éö„Éº„Ç∏„ÇíË°®Á§∫‰∏≠: „Åô„Åπ„Å¶„ÅÆ„Éà„Éº„Çπ„ÉàÈÄöÁü•„ÇíÁÑ°ÂäπÂåñ„Åó„Åæ„Åô');
            
            // Â∞ë„ÅóÂæÖ„Å£„Å¶„Åã„Çâ„Éà„Éº„Çπ„ÉàÂàùÊúüÂåñ„Å®ÂâäÈô§„ÇíÂÆüË°åÔºàDOM„ÅåÂÆåÂÖ®„Å´Ë™≠„ÅøËæº„Åæ„Çå„Çã„ÅÆ„ÇíÂæÖ„Å§Ôºâ
            setTimeout(() => {
                // Êó¢Â≠ò„ÅÆ„Åô„Åπ„Å¶„ÅÆ„Éà„Éº„Çπ„ÉàË¶ÅÁ¥†„ÇíÂèñÂæó„Åó„Å¶ÈùûË°®Á§∫
                document.querySelectorAll('.toast').forEach(toast => {
                    try {
                        // Bootstrap„Éà„Éº„Çπ„Éà„Ç§„É≥„Çπ„Çø„É≥„Çπ„ÇíÂèñÂæó
                        const toastInstance = bootstrap.Toast.getInstance(toast);
                        if (toastInstance) {
                            toastInstance.hide();
                            console.log('Êó¢Â≠ò„ÅÆ„Éà„Éº„Çπ„ÉàÈÄöÁü•„ÇíÈùûË°®Á§∫„Å´„Åó„Åæ„Åó„Åü');
                        }
                        
                        // Áõ¥Êé•CSS„ÅßÈùûË°®Á§∫„Å´
                        toast.classList.remove('show');
                        toast.style.display = 'none';
                        toast.remove();  // ÂÆåÂÖ®„Å´ÂâäÈô§
                    } catch (e) {
                        console.error('„Éà„Éº„Çπ„ÉàÈùûË°®Á§∫Âá¶ÁêÜ„Ç®„É©„Éº:', e);
                    }
                });
                
                // ÈÄöÁü•„Ç≥„É≥„ÉÜ„Éä„ÇÇ„ÇØ„É™„Ç¢
                const toastContainer = document.querySelector('.toast-container');
                if (toastContainer) {
                    // ÂÜÖÈÉ®Ë¶ÅÁ¥†„Çí‰∏ÄÊó¶ÂÖ®„Å¶ÂâäÈô§ÔºàÊúÄÂàù„ÅÆÂ≠êË¶ÅÁ¥†„ÅÆ„ÅøÊÆã„ÅôÔºâ
                    while (toastContainer.children.length > 1) {
                        if (toastContainer.lastChild.id !== 'chatNotification') {
                            toastContainer.removeChild(toastContainer.lastChild);
                        }
                    }
                }
                
                console.log('„Éà„Éº„Çπ„ÉàÈÄöÁü•„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åó„Åü');
            }, 100);
        }
        
        // „ÉÅ„É£„ÉÉ„ÉàË©≥Á¥∞ÁîªÈù¢„Å´„ÅÑ„ÇãÂ†¥Âêà„ÄÅ‰ºöË©±ID„ÇíÂèñÂæó
        let currentConversationId = null;
        // ÈÄöÂ∏∏„ÅÆ‰ºöË©±ID„Å®newÂΩ¢Âºè„ÅÆ‰∏°Êñπ„Å´ÂØæÂøú
        const chatMatch = currentPath.match(/\/chats\/(?:new\/)?(\d+)\//);
        if (chatMatch && chatMatch[1]) {
            currentConversationId = chatMatch[1];
            console.log('ÁèæÂú®Ë°®Á§∫‰∏≠„ÅÆ‰ºöË©±ID:', currentConversationId);
        }
        
        // SSEÊé•Á∂ö„ÇíÁ¢∫Á´ã
        console.log('SSEÊé•Á∂ö„ÇíÈñãÂßã„Åó„Åæ„Åô...');
        let eventSource = new EventSource("{% url 'chats:message_stream' %}");
        const chatNotification = document.getElementById('chatNotification');
        const toastContainer = document.querySelector('.toast-container');
        
        console.log('üîç ÂàùÊúüÂåñÁ¢∫Ë™ç - chatNotification:', chatNotification);
        console.log('üîç ÂàùÊúüÂåñÁ¢∫Ë™ç - toastContainer:', toastContainer);
        
        if (!chatNotification) {
            console.error('chatNotificationË¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„ÇìÔºÅ');
        }
        
        if (!toastContainer) {
            console.error('toastContainerË¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„ÇìÔºÅ');
        }
        
        // Êé•Á∂öÊàêÂäüÊôÇ„ÅÆ„Ç§„Éô„É≥„Éà
        eventSource.onopen = function(event) {
            console.log('SSEÊé•Á∂ö„ÅåÁ¢∫Á´ã„Åï„Çå„Åæ„Åó„ÅüÔºÅ');
            console.log('SSEÊé•Á∂öÁä∂ÊÖã:', eventSource.readyState);
            
            // 5Áßí„Åî„Å®„Å´Êé•Á∂öÁä∂ÊÖã„Çí„ÉÅ„Çß„ÉÉ„ÇØ
            setInterval(() => {
                console.log('SSEÊé•Á∂öÁä∂ÊÖã„ÉÅ„Çß„ÉÉ„ÇØ:', eventSource.readyState);
                // 0: Êé•Á∂ö‰∏≠, 1: Èñã„ÅÑ„Å¶„ÅÑ„Çã, 2: Èñâ„Åò„Å¶„ÅÑ„Çã
                if (eventSource.readyState === 2) {
                    console.log('SSEÊé•Á∂ö„ÅåÈñâ„Åò„Çâ„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇÂÜçÊé•Á∂ö„ÇíË©¶„Åø„Åæ„Åô...');
                    reconnectSSE();
                }
            }, 5000);
        };
        
        // „É°„ÉÉ„Çª„Éº„Ç∏Âèó‰ø°ÊôÇ„ÅÆ„Ç§„Éô„É≥„Éà
        eventSource.onmessage = function(event) {
            // „Ç≠„Éº„Éó„Ç¢„É©„Ç§„Éñ„É°„ÉÉ„Çª„Éº„Ç∏„ÅØÁÑ°Ë¶ñ
            if (event.data === ': keepalive') {
                // „Ç≠„Éº„Éó„Ç¢„É©„Ç§„Éñ„É°„ÉÉ„Çª„Éº„Ç∏„ÅÆ„É≠„Ç∞„ÅØ10Áßí„Å´1Âõû„Å†„ÅëÂá∫Âäõ
                const now = Date.now();
                if (!window.lastKeepAliveLog || now - window.lastKeepAliveLog > 10000) {
                    console.log('„Ç≠„Éº„Éó„Ç¢„É©„Ç§„Éñ„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂèó‰ø°');
                    window.lastKeepAliveLog = now;
                }
                return;
            }
            
            console.log('SSE„É°„ÉÉ„Çª„Éº„Ç∏Âèó‰ø°ÔºàÁîü„Éá„Éº„ÇøÔºâ:', event.data);
            console.log('SSE„É°„ÉÉ„Çª„Éº„Ç∏Âèó‰ø°Ôºà„Éá„Éº„ÇøÂûãÔºâ:', typeof event.data);
            console.log('SSE„É°„ÉÉ„Çª„Éº„Ç∏Âèó‰ø°ÔºàÈï∑„ÅïÔºâ:', event.data.length);
            
            try {
                const data = JSON.parse(event.data);
                console.log('SSE„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂèó‰ø°Ôºà„Éë„Éº„ÇπÂæåÔºâ:', data);
                console.log('„É°„ÉÉ„Çª„Éº„Ç∏„Çø„Ç§„Éó:', data.type);
                
                if (data.type === 'new_message') {
                    const messageData = data.data;
                    console.log('Êñ∞„Åó„ÅÑ„É°„ÉÉ„Çª„Éº„Ç∏:', messageData);
                    
                    // Ëá™ÂàÜ„ÅåÈÄÅ‰ø°ËÄÖ„ÅÆÂ†¥Âêà„ÅØÈÄöÁü•„ÇíË°®Á§∫„Åó„Å™„ÅÑ
                    if (messageData.sender_id.toString() === myUserId) {
                        console.log('Ëá™ÂàÜ„ÅåÈÄÅ‰ø°„Åó„Åü„É°„ÉÉ„Çª„Éº„Ç∏„Å™„ÅÆ„ÅßÈÄöÁü•„Çí„Çπ„Ç≠„ÉÉ„Éó„Åó„Åæ„Åô');
                        return;
                    }
                    
                    console.log('üîç ÈÄöÁü•Âá¶ÁêÜ„ÇíÈñãÂßã„Åó„Åæ„Åô');
                    
                    // ÁèæÂú®„ÅÆURL„ÅåÂ§â„Çè„Å£„Å¶„ÅÑ„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çã„ÅÆ„ÅßÂÜçÂèñÂæó
                    const currentPath = window.location.pathname;
                    
                    // URL„Éë„Çø„Éº„É≥„ÇíÊîπÂñÑÔºö/chats/„ÇÑ/chats/new/„ÇíÂê´„ÇÄ„Éë„Çø„Éº„É≥„Å´ÂØæÂøú
                    const isOnChatPage = currentPath.includes(`/chats/`) && 
                        (currentPath.includes(`/${messageData.conversation_id}/`) || 
                         currentPath.includes(`/new/${messageData.conversation_id}/`));
                    
                    console.log('ÁèæÂú®„ÅÆURL:', currentPath);
                    console.log('‰ºöË©±ID:', messageData.conversation_id);
                    console.log('„ÉÅ„É£„ÉÉ„Éà„Éö„Éº„Ç∏„Å´„ÅÑ„Çã„Åã:', isOnChatPage);
                    
                    // ÁèæÂú®„ÅÆ„ÉÅ„É£„ÉÉ„Éà„Éö„Éº„Ç∏„Å´„ÅÑ„ÇãÂ†¥Âêà„ÅØÈÄöÁü•„ÇíË°®Á§∫„Åó„Å™„ÅÑ
                    if (isOnChatPage) {
                        console.log('ÁèæÂú®„Åì„ÅÆ„ÉÅ„É£„ÉÉ„Éà„Éö„Éº„Ç∏„ÇíË°®Á§∫‰∏≠„ÅÆ„Åü„ÇÅ„ÄÅÈÄöÁü•„Çí„Çπ„Ç≠„ÉÉ„Éó„Åó„Åæ„Åô');
                        return;
                    }
                    
                    // ÈÄöÁü•Èü≥„ÇíÂÜçÁîü
                    notificationSound.play().catch(e => console.log('ÈÄöÁü•Èü≥„ÅÆÂÜçÁîü„Å´Â§±Êïó:', e));
                    
                    try {
                        // ÁèæÂú®„ÉÅ„É£„ÉÉ„ÉàÈñ¢ÈÄ£„Éö„Éº„Ç∏„Å´„ÅÑ„ÇãÂ†¥Âêà„ÅØ„Åô„Åπ„Å¶„ÅÆÈÄöÁü•„Çí„Çπ„Ç≠„ÉÉ„Éó
                        const currentPath = window.location.pathname;
                        const isOnAnyChat = currentPath.includes('/chats/');
                        
                        if (isOnAnyChat) {
                            console.log('ÁèæÂú®„ÉÅ„É£„ÉÉ„ÉàÁîªÈù¢„ÅÆ„Åü„ÇÅ„ÄÅÈÄöÁü•„ÅÆË°®Á§∫„Çí„Çπ„Ç≠„ÉÉ„Éó„Åó„Åæ„Åô');
                            return;
                        }
                        
                        // ÈÄöÁü•„ÇíË°®Á§∫„Åô„ÇãÔºà„ÉÅ„É£„ÉÉ„Éà„Éö„Éº„Ç∏„Å´„ÅÑ„Å™„Åë„Çå„Å∞Ôºâ
                        console.log('ÈÄöÁü•„ÇíË°®Á§∫„Åó„Åæ„Åô');
                        showChatNotification(messageData);
                        
                        // Êú™Ë™≠„Ç´„Ç¶„É≥„Éà„ÇíÊõ¥Êñ∞
                        unreadCount++;
                        toastContainer.setAttribute('data-unread', unreadCount);
                        console.log('Êú™Ë™≠„Ç´„Ç¶„É≥„ÉàÊõ¥Êñ∞:', unreadCount);
                    } catch (error) {
                        console.error('ÈÄöÁü•Ë°®Á§∫„Ç®„É©„Éº:', error);
                    }
                    
                    // ÂÖ•ÂÆ§ÈÄöÁü•„ÅÆÂ†¥Âêà„ÅØ„É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫
                    if (messageData.content.includes('„ÉÅ„É£„ÉÉ„Éà„É´„Éº„É†„Å´ÂÖ•„Çä„Åæ„Åó„Åü')) {
                        // „ÉÅ„É£„ÉÉ„ÉàÁîªÈù¢ÂÜÖ„Å´Ë°®Á§∫„Åï„Çå„ÇãÂÖ•ÂÆ§„É°„ÉÉ„Çª„Éº„Ç∏„Å®ÈáçË§á„Åô„Çã„ÅÆ„Åß„ÄÅ„ÉÅ„É£„ÉÉ„ÉàÁîªÈù¢„Å´„ÅÑ„ÇãÂ†¥Âêà„ÅØ„Éà„Éº„Çπ„ÉàÈÄöÁü•„Çí„Çπ„Ç≠„ÉÉ„Éó
                        const currentPath = window.location.pathname;
                        const isOnAnyChat = currentPath.includes('/chats/');
                        
                        if (isOnAnyChat) {
                            console.log('ÁèæÂú®„ÉÅ„É£„ÉÉ„ÉàÁîªÈù¢„ÅÆ„Åü„ÇÅ„ÄÅÂÖ•ÂÆ§ÈÄöÁü•„É¢„Éº„ÉÄ„É´„ÅÆË°®Á§∫„Çí„Çπ„Ç≠„ÉÉ„Éó„Åó„Åæ„Åô');
                            return;
                        }
                        
                        showEnterModal(messageData);
                    }
                    
                    // ÈÄÄÂÆ§ÈÄöÁü•„ÅÆÂ†¥Âêà„ÅØ„É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫
                    if (messageData.content.includes('„ÉÅ„É£„ÉÉ„Éà„É´„Éº„É†„Åã„ÇâÈÄÄÂÆ§„Åó„Åæ„Åó„Åü')) {
                        // „ÉÅ„É£„ÉÉ„ÉàÁîªÈù¢ÂÜÖ„Å´Ë°®Á§∫„Åï„Çå„ÇãÈÄÄÂÆ§„É°„ÉÉ„Çª„Éº„Ç∏„Å®ÈáçË§á„Åô„Çã„ÅÆ„Åß„ÄÅ„ÉÅ„É£„ÉÉ„ÉàÁîªÈù¢„Å´„ÅÑ„ÇãÂ†¥Âêà„ÅØ„Éà„Éº„Çπ„ÉàÈÄöÁü•„Çí„Çπ„Ç≠„ÉÉ„Éó
                        const currentPath = window.location.pathname;
                        const isOnAnyChat = currentPath.includes('/chats/');
                        
                        if (isOnAnyChat) {
                            console.log('ÁèæÂú®„ÉÅ„É£„ÉÉ„ÉàÁîªÈù¢„ÅÆ„Åü„ÇÅ„ÄÅÈÄÄÂÆ§ÈÄöÁü•„É¢„Éº„ÉÄ„É´„ÅÆË°®Á§∫„Çí„Çπ„Ç≠„ÉÉ„Éó„Åó„Åæ„Åô');
                            return;
                        }
                        
                        showExitModal(messageData);
                    }
                }
            } catch (e) {
                console.error('„É°„ÉÉ„Çª„Éº„Ç∏„ÅÆËß£Êûê„Ç®„É©„Éº:', e);
            }
        };
        
        // „Ç®„É©„ÉºÁô∫ÁîüÊôÇ„ÅÆ„Ç§„Éô„É≥„Éà
        eventSource.onerror = function(error) {
            console.error('SSEÊé•Á∂ö„Ç®„É©„Éº:', error);
            console.log('SSEÊé•Á∂öÁä∂ÊÖã:', eventSource.readyState);
            
            // Êé•Á∂ö„ÅåÈñâ„Åò„Çâ„Çå„ÅüÂ†¥Âêà„ÅÆ„ÅøÂÜçÊé•Á∂ö„ÇíË©¶„Åø„Çã
            if (eventSource.readyState === EventSource.CLOSED) {
                console.log('SSEÊé•Á∂ö„ÅåÈñâ„Åò„Çâ„Çå„Åæ„Åó„Åü„ÄÇÂÜçÊé•Á∂ö„ÇíË©¶„Åø„Åæ„Åô...');
                
                // 3ÁßíÂæå„Å´ÂÜçÊé•Á∂ö
                setTimeout(reconnectSSE, 3000);
            }
        };
        
        // ÂÜçÊé•Á∂öÈñ¢Êï∞
        function reconnectSSE() {
            console.log('SSEÂÜçÊé•Á∂ö„ÇíÂÆüË°å„Åó„Åæ„Åô...');
            
            // Âè§„ÅÑÊé•Á∂ö„ÇíÈñâ„Åò„Çã
            eventSource.close();
            
            // Êñ∞„Åó„ÅÑÊé•Á∂ö„Çí‰ΩúÊàê
            eventSource = new EventSource("{% url 'chats:message_stream' %}");
            
            // „Ç§„Éô„É≥„Éà„Éè„É≥„Éâ„É©„ÇíË®≠ÂÆö
            eventSource.onopen = function(event) {
                console.log('SSEÂÜçÊé•Á∂ö„ÅåÊàêÂäü„Åó„Åæ„Åó„ÅüÔºÅ');
                console.log('SSEÊé•Á∂öÁä∂ÊÖã:', eventSource.readyState);
            };
            
            // ÂÜçÊé•Á∂öÂæå„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏„Éè„É≥„Éâ„É©„ÅØ‰∏äË®ò„Å®Âêå„Åò„ÇÇ„ÅÆ„Çí‰ΩøÁî®„Åô„Çã„Åü„ÇÅÁúÅÁï•
            
            eventSource.onerror = function(error) {
                console.error('SSEÊé•Á∂ö„Ç®„É©„Éº:', error);
                console.log('SSEÊé•Á∂öÁä∂ÊÖã:', eventSource.readyState);
                
                // Êé•Á∂ö„ÅåÈñâ„Åò„Çâ„Çå„ÅüÂ†¥Âêà„ÅÆ„ÅøÂÜçÊé•Á∂ö„ÇíË©¶„Åø„Çã
                if (eventSource.readyState === EventSource.CLOSED) {
                    console.log('SSEÊé•Á∂ö„ÅåÈñâ„Åò„Çâ„Çå„Åæ„Åó„Åü„ÄÇÂÜçÊé•Á∂ö„ÇíË©¶„Åø„Åæ„Åô...');
                    
                    // 3ÁßíÂæå„Å´ÂÜçÊé•Á∂ö
                    setTimeout(reconnectSSE, 3000);
                }
            };
        }
        
        // ÈÄöÁü•Èü≥
        const notificationSound = new Audio("{% static 'sounds/notification.mp3' %}");
        
        // ÈÄöÁü•„Ç´„Ç¶„É≥„Çø„Éº
        let unreadCount = parseInt(toastContainer.getAttribute('data-unread')) || 0;
        
        // „Éö„Éº„Ç∏„É≠„Éº„ÉâÊôÇ„Å´Êú™Ë™≠„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂèñÂæó
        fetch("{% url 'chats:get_unread_messages' %}")
            .then(response => response.json())
            .then(data => {
                console.log('Êú™Ë™≠„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂèñÂæó:', data);
                
                // „ÉÅ„É£„ÉÉ„Éà„Éö„Éº„Ç∏„Å´„ÅÑ„ÇãÂ†¥Âêà„ÅØ„É°„ÉÉ„Çª„Éº„Ç∏ÈÄöÁü•„Çí„Çπ„Ç≠„ÉÉ„Éó
                if (isOnChatPage) {
                    console.log('„ÉÅ„É£„ÉÉ„Éà„Éö„Éº„Ç∏„Å´„ÅÑ„Çã„Åü„ÇÅÊú™Ë™≠„É°„ÉÉ„Çª„Éº„Ç∏ÈÄöÁü•„Çí„Çπ„Ç≠„ÉÉ„Éó„Åó„Åæ„Åô');
                    return;
                }
                
                if (data.status === 'success' && data.unread_messages && data.unread_messages.length > 0) {
                    // ÈÄÅ‰ø°ËÄÖ„Åî„Å®„Å´ÊúÄÊñ∞„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏„Å†„Åë„Çí‰øùÊåÅ
                    const latestMessagesBySender = {};
                    
                    // Âá¶ÁêÜÂâç„ÅÆÊú™Ë™≠„É°„ÉÉ„Çª„Éº„Ç∏Êï∞
                    console.log('„Éï„Ç£„É´„Çø„É™„É≥„Ç∞Ââç„ÅÆÊú™Ë™≠„É°„ÉÉ„Çª„Éº„Ç∏Êï∞:', data.unread_messages.length);
                    
                    // Ëá™ÂàÜ„ÅåÈÄÅ‰ø°ËÄÖ„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏„Å®ÁèæÂú®Ë°®Á§∫‰∏≠„ÅÆ‰ºöË©±„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÈô§Â§ñ
                    const filteredMessages = data.unread_messages.filter(message => {
                        // ÊòéÁ§∫ÁöÑ„Å´ÂûãÂ§âÊèõ„Åó„Å¶ÊØîËºÉ
                        const isMine = String(message.sender_id) === String(myUserId);
                        if (isMine) {
                            console.log('Ëá™ÂàÜ„ÅåÈÄÅ‰ø°„Åó„Åü„É°„ÉÉ„Çª„Éº„Ç∏„Å™„ÅÆ„ÅßÈÄöÁü•„Çí„Çπ„Ç≠„ÉÉ„Éó„Åó„Åæ„Åô:', message);
                            return false;
                        }
                        
                        // ÁèæÂú®Ë°®Á§∫‰∏≠„ÅÆ„ÉÅ„É£„ÉÉ„ÉàÁîªÈù¢„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏„ÅÆÂ†¥Âêà„ÅØÈÄöÁü•„Åó„Å™„ÅÑ
                        // URL„Éë„Çø„Éº„É≥„ÇíÊîπÂñÑÔºö/chats/„ÇÑ/chats/new/„ÇíÂê´„ÇÄ„Éë„Çø„Éº„É≥„Å´ÂØæÂøú
                        const isCurrentConversation = 
                            (currentPath.includes(`/chats/${message.conversation_id}/`) || 
                             currentPath.includes(`/chats/new/${message.conversation_id}/`));
                        
                        if (isCurrentConversation) {
                            console.log('ÁèæÂú®Ë°®Á§∫‰∏≠„ÅÆ‰ºöË©±„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏„Å™„ÅÆ„ÅßÈÄöÁü•„Çí„Çπ„Ç≠„ÉÉ„Éó„Åó„Åæ„Åô:', message);
                            return false;
                        }
                        
                        return true;
                    });
                    
                    console.log('„Éï„Ç£„É´„Çø„É™„É≥„Ç∞Âæå„ÅÆÊú™Ë™≠„É°„ÉÉ„Çª„Éº„Ç∏Êï∞:', filteredMessages.length);
                    
                    // Ë°®Á§∫„Åô„Åπ„Åç„É°„ÉÉ„Çª„Éº„Ç∏„Åå„Å™„ÅÑÂ†¥Âêà„ÅØÂá¶ÁêÜ„ÇíÁµÇ‰∫Ü
                    if (filteredMessages.length === 0) {
                        console.log('Ë°®Á§∫„Åô„Åπ„ÅçÊú™Ë™≠„É°„ÉÉ„Çª„Éº„Ç∏„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì');
                        return;
                    }
                    
                    // ÂêÑ„É°„ÉÉ„Çª„Éº„Ç∏„Çí„É´„Éº„Éó„Åó„Å¶„ÄÅÈÄÅ‰ø°ËÄÖ„Åî„Å®„Å´ÊúÄÊñ∞„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÁâπÂÆö
                    filteredMessages.forEach(message => {
                        const senderId = message.sender_id;
                        
                        // „Åì„ÅÆÈÄÅ‰ø°ËÄÖ„Åã„Çâ„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏„Åå„Åæ„Å†„Å™„ÅÑ„ÄÅ„Åæ„Åü„ÅØÁèæÂú®„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏„ÅåÊúÄÊñ∞„ÅÆÂ†¥Âêà
                        if (!latestMessagesBySender[senderId] || 
                            new Date(message.timestamp) > new Date(latestMessagesBySender[senderId].timestamp)) {
                            latestMessagesBySender[senderId] = message;
                        }
                    });
                    
                    // Êï¥ÁêÜ„Åï„Çå„ÅüÊúÄÊñ∞„É°„ÉÉ„Çª„Éº„Ç∏„ÅÆÊï∞„ÇíË°®Á§∫
                    console.log('Ë°®Á§∫„Åô„ÇãÊúÄÊñ∞„É°„ÉÉ„Çª„Éº„Ç∏Êï∞:', Object.keys(latestMessagesBySender).length);
                    
                    // ÊúÄÊñ∞„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏„Å†„Åë„ÇíË°®Á§∫
                    Object.values(latestMessagesBySender).forEach(message => {
                        // Âøµ„ÅÆ„Åü„ÇÅ„ÄÅ„ÇÇ„ÅÜ‰∏ÄÂ∫¶Á¢∫Ë™ç
                        if (String(message.sender_id) === String(myUserId)) {
                            console.log('ÊúÄÁµÇ„ÉÅ„Çß„ÉÉ„ÇØ„ÅßËá™ÂàÜ„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏„Çí„Çπ„Ç≠„ÉÉ„Éó:', message);
                            return;
                        }
                        
                        const messageData = {
                            sender_id: message.sender_id,
                            sender_name: message.sender_name,
                            conversation_id: message.conversation_id,
                            content: message.content,
                            timestamp: message.timestamp
                        };
                        showChatNotification(messageData);
                        
                        // Êú™Ë™≠„Ç´„Ç¶„É≥„Éà„ÇíÊõ¥Êñ∞
                        unreadCount++;
                    });
                    
                    toastContainer.setAttribute('data-unread', unreadCount);
                }
            })
            .catch(error => {
                console.error('Êú™Ë™≠„É°„ÉÉ„Çª„Éº„Ç∏„ÅÆÂèñÂæó„Ç®„É©„Éº:', error);
            });
        
        // ÂÖ•ÂÆ§„É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫„Åô„ÇãÈñ¢Êï∞
        function showEnterModal(messageData) {
            // „É¢„Éº„ÉÄ„É´Ë°®Á§∫Ââç„Å´ËÉåÊôØ„Çí„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
            cleanupModalBackdrops();
            
            const enterModal = document.getElementById('enterModal');
            if (!enterModal) return;
            
            const senderName = document.getElementById('e-sender-name');
            const timeElement = document.getElementById('e-time');
            const gotoButton = document.getElementById('e-goto-chat');
            
            if (senderName) senderName.textContent = messageData.sender_name;
            if (timeElement) timeElement.textContent = new Date().toLocaleTimeString();
            
            if (gotoButton) {
                // Âè§„ÅÑ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíÂâäÈô§„Åó„Å¶„Åã„ÇâÊñ∞„Åó„ÅÑ„ÇÇ„ÅÆ„ÇíËøΩÂä†ÔºàÈáçË§áÈò≤Ê≠¢Ôºâ
                gotoButton.replaceWith(gotoButton.cloneNode(true));
                const newGotoButton = document.getElementById('e-goto-chat');
                
                newGotoButton.addEventListener('click', function() {
                    // „É™„É≥„ÇØÂÖà„Å´ÁßªÂãï„Åô„ÇãÂâç„Å´„É¢„Éº„ÉÄ„É´ËÉåÊôØ„ÇíÂâäÈô§
                    cleanupModalBackdrops();
                    window.location.href = `/chats/${messageData.conversation_id}/`;
                });
            }
            
            // ÊãíÁµ∂„Åô„Çã„Éú„Çø„É≥
            const rejectButton = enterModal.querySelector('.btn[style*="background: rgba(255, 80, 80, 0.2)"]');
            if (rejectButton) {
                rejectButton.addEventListener('click', function() {
                    setTimeout(cleanupModalBackdrops, 100);
                });
            }
            
            // „ÅÇ„Å®„Åß„Éú„Çø„É≥
            const laterButton = enterModal.querySelector('.btn-secondary');
            if (laterButton) {
                laterButton.addEventListener('click', function() {
                    setTimeout(cleanupModalBackdrops, 100);
                });
            }
            
            // Èñâ„Åò„Çã„Éú„Çø„É≥
            const closeButton = enterModal.querySelector('.btn-close');
            if (closeButton) {
                closeButton.addEventListener('click', function() {
                    setTimeout(cleanupModalBackdrops, 100);
                });
            }
            
            const modal = new bootstrap.Modal(enterModal);
            modal.show();
            
            // „É¢„Éº„ÉÄ„É´„ÅåÈñâ„Åò„Çâ„Çå„ÅüÊôÇ„ÅÆ„Ç§„Éô„É≥„Éà
            enterModal.addEventListener('hidden.bs.modal', function() {
                setTimeout(cleanupModalBackdrops, 100);
            });
        }
        
        // „ÉÅ„É£„ÉÉ„ÉàÈÄöÁü•„ÇíË°®Á§∫„Åô„ÇãÈñ¢Êï∞
        function showChatNotification(messageData) {
            console.log('üîç showChatNotificationÈñ¢Êï∞„ÅåÂëº„Å≥Âá∫„Åï„Çå„Åæ„Åó„Åü', messageData);
            
            // Êó¢Â≠ò„ÅÆÂêå„ÅòÈÄÅ‰ø°ËÄÖ„Åã„Çâ„ÅÆÈÄöÁü•„ÇíÂâäÈô§
            const existingNotifications = document.querySelectorAll(`.toast[data-sender-id="${messageData.sender_id}"]`);
            console.log('Êó¢Â≠ò„ÅÆÈÄöÁü•Êï∞:', existingNotifications.length);
            existingNotifications.forEach(notification => {
                // Bootstrap„ÅÆ„Éà„Éº„Çπ„Éà„Ç§„É≥„Çπ„Çø„É≥„Çπ„ÇíÂèñÂæó„Åó„Å¶ÈùûË°®Á§∫„Å´„Åô„Çã
                const toastInstance = bootstrap.Toast.getInstance(notification);
                if (toastInstance) {
                    toastInstance.hide();
                    console.log('Êó¢Â≠ò„ÅÆÈÄöÁü•„ÇíÈùûË°®Á§∫„Å´„Åó„Åæ„Åó„Åü');
                }
                // Ë¶ÅÁ¥†„ÇíÂâäÈô§
                notification.remove();
                console.log('Êó¢Â≠ò„ÅÆÈÄöÁü•„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü');
            });
            
            // ÈÄöÁü•Ë¶ÅÁ¥†„ÅÆ„ÇØ„É≠„Éº„É≥„Çí‰ΩúÊàê
            const notification = chatNotification.cloneNode(true);
            notification.id = `chatNotification-${Date.now()}`;
            notification.setAttribute('data-sender-id', messageData.sender_id);
            notification.style.display = 'block';
            console.log('ÈÄöÁü•Ë¶ÅÁ¥†„Çí‰ΩúÊàê„Åó„Åæ„Åó„Åü:', notification.id);
            
            // ÈÄöÁü•ÂÜÖÂÆπ„ÇíË®≠ÂÆö
            const senderName = notification.querySelector('.sender-name');
            const messageContainer = notification.querySelector('.chat-message-container');
            const buttonsContainer = notification.querySelector('.chat-buttons-container');
            const replyButton = notification.querySelector('.chat-reply-btn');
            
            if (senderName) senderName.textContent = messageData.sender_name;
            
            // „É°„ÉÉ„Çª„Éº„Ç∏ÂÜÖÂÆπ„Å´Âøú„Åò„Å¶Ë°®Á§∫„ÉÜ„Ç≠„Çπ„Éà„ÇíÂ§âÊõ¥
            if (messageContainer) {
                messageContainer.style.display = 'block';
                
                // „É°„ÉÉ„Çª„Éº„Ç∏„Çø„Ç§„Éó„Å´„Çà„Å£„Å¶Ë°®Á§∫ÂÜÖÂÆπ„ÇíÂ§âÊõ¥
                if (messageData.content && messageData.content.includes('„ÉÅ„É£„ÉÉ„Éà„É´„Éº„É†„Åã„ÇâÈÄÄÂÆ§„Åó„Åæ„Åó„Åü')) {
                    // ÈÄÄÂÆ§„É°„ÉÉ„Çª„Éº„Ç∏„ÅÆÂ†¥Âêà
                    messageContainer.innerHTML = `<strong class="sender-name">${messageData.sender_name}</strong>„Åå„ÉÅ„É£„ÉÉ„Éà„É´„Éº„É†„Åã„ÇâÈÄÄÂÆ§„Åó„Åæ„Åó„Åü`;
                    
                    // ÈÄÄÂÆ§ÈÄöÁü•„ÅÆÂ†¥Âêà„ÅØ„Éú„Çø„É≥„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„ÇÇÂ§âÊõ¥
                    const replyBtn = notification.querySelector('.chat-reply-btn');
                    if (replyBtn) {
                        replyBtn.textContent = '„ÉÅ„É£„ÉÉ„Éà„ÇíÁ¢∫Ë™ç';
                    }
                } else if (messageData.content && messageData.content.includes('„ÉÅ„É£„ÉÉ„Éà„É´„Éº„É†„Å´ÂÖ•„Çä„Åæ„Åó„Åü')) {
                    // ÂÖ•ÂÆ§„É°„ÉÉ„Çª„Éº„Ç∏„ÅÆÂ†¥Âêà
                    messageContainer.innerHTML = `<strong class="sender-name">${messageData.sender_name}</strong>„Åå„ÉÅ„É£„ÉÉ„Éà„É´„Éº„É†„Å´ÂÖ•ÂÆ§„Åó„Åæ„Åó„Åü`;
                } else {
                    // ÈÄöÂ∏∏„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏„ÅÆÂ†¥Âêà
                    messageContainer.innerHTML = `<strong class="sender-name">${messageData.sender_name}</strong>„Åå„ÄÅ„ÉÅ„É£„ÉÉ„Éà„ÅßË©±„Åó„Åã„Åë„Å¶„ÅÑ„Åæ„Åô`;
                }
            }
            
            if (buttonsContainer) buttonsContainer.style.display = 'flex';
            console.log('ÈÄöÁü•ÂÜÖÂÆπ„ÇíË®≠ÂÆö„Åó„Åæ„Åó„Åü');
            
            // Ëøî‰ø°„Éú„Çø„É≥„ÅÆ„É™„É≥„ÇØÂÖà„ÇíË®≠ÂÆö
            if (replyButton) {
                replyButton.addEventListener('click', function() {
                    // „É™„É≥„ÇØÂÖà„Å´ÁßªÂãï„Åô„ÇãÂâç„Å´„É¢„Éº„ÉÄ„É´ËÉåÊôØ„ÇíÂâäÈô§
                    cleanupModalBackdrops();
                    window.location.href = `/chats/${messageData.conversation_id}/`;
                });
                console.log('Ëøî‰ø°„Éú„Çø„É≥„ÅÆ„É™„É≥„ÇØ„ÇíË®≠ÂÆö„Åó„Åæ„Åó„Åü');
            }
            
            // „Äå„ÅÇ„Å®„Åß„Äç„Éú„Çø„É≥„Å´„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíËøΩÂä†
            const laterButton = notification.querySelector('[data-bs-dismiss="toast"]');
            if (laterButton) {
                laterButton.addEventListener('click', function() {
                    // „ÇØ„É™„ÉÉ„ÇØÊôÇ„Å´ÊòéÁ§∫ÁöÑ„Å´„É¢„Éº„ÉÄ„É´ËÉåÊôØ„Çí„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
                    console.log('„Äå„ÅÇ„Å®„Åß„Äç„Éú„Çø„É≥„Åå„ÇØ„É™„ÉÉ„ÇØ„Åï„Çå„Åæ„Åó„Åü - „É¢„Éº„ÉÄ„É´ËÉåÊôØ„Çí„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó„Åó„Åæ„Åô');
                    setTimeout(cleanupModalBackdrops, 100);
                });
            }
            
            // „ÄåÊãíÁµ∂„Åô„Çã„Äç„Éú„Çø„É≥„Å´„ÇÇ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíËøΩÂä†
            const blockButton = notification.querySelector('.block-user-btn');
            if (blockButton) {
                blockButton.addEventListener('click', function() {
                    // „ÇØ„É™„ÉÉ„ÇØÊôÇ„Å´ÊòéÁ§∫ÁöÑ„Å´„É¢„Éº„ÉÄ„É´ËÉåÊôØ„Çí„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
                    console.log('„ÄåÊãíÁµ∂„Åô„Çã„Äç„Éú„Çø„É≥„Åå„ÇØ„É™„ÉÉ„ÇØ„Åï„Çå„Åæ„Åó„Åü - „É¢„Éº„ÉÄ„É´ËÉåÊôØ„Çí„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó„Åó„Åæ„Åô');
                    setTimeout(cleanupModalBackdrops, 100);
                });
            }
            
            // ÈÄöÁü•„ÇíË°®Á§∫
            toastContainer.appendChild(notification);
            console.log('ÈÄöÁü•Ë¶ÅÁ¥†„ÇíDOM„Å´ËøΩÂä†„Åó„Åæ„Åó„Åü');
            
            // Âº∑Âà∂ÁöÑ„Å´DOM„ÅÆÂÜçÊèèÁîª„Çí‰øÉ„Åô
            setTimeout(() => {
                try {
                    // Bootstrap 5„ÅÆToast„ÇØ„É©„Çπ„Çí‰ΩøÁî®„Åó„Å¶ÂàùÊúüÂåñ
                    const toast = new bootstrap.Toast(notification, {
                        autohide: true,
                        delay: 10000
                    });
                    
                    // ÊòéÁ§∫ÁöÑ„Å´Ë°®Á§∫
                    toast.show();
                    console.log('ÈÄöÁü•„ÇíË°®Á§∫„Åó„Åæ„Åó„Åü');
                    
                    // Âøµ„ÅÆ„Åü„ÇÅ„ÄÅCSS„Åß„ÇÇË°®Á§∫„ÇíÂº∑Âà∂
                    notification.classList.add('show');
                    notification.style.opacity = '1';
                    notification.style.display = 'block';
                } catch (error) {
                    console.error('„Éà„Éº„Çπ„ÉàË°®Á§∫„Ç®„É©„Éº:', error);
                    // „Ç®„É©„ÉºÊôÇ„ÅÆ„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÂá¶ÁêÜ
                    notification.classList.add('show');
                    notification.style.opacity = '1';
                    notification.style.display = 'block';
                }
            }, 100);
            
            // ÈÄöÁü•„ÅåÈñâ„Åò„Çâ„Çå„Åü„Å®„Åç„ÅÆÂá¶ÁêÜ
            notification.addEventListener('hidden.bs.toast', function() {
                notification.remove();
                console.log('ÈÄöÁü•„ÅåÈñâ„Åò„Çâ„Çå„ÄÅÂâäÈô§„Åï„Çå„Åæ„Åó„Åü');
                
                // ÈÄöÁü•„ÅåÈñâ„Åò„Çâ„Çå„ÅüÊôÇ„Å´„ÇÇ„É¢„Éº„ÉÄ„É´ËÉåÊôØ„Çí„ÉÅ„Çß„ÉÉ„ÇØ
                cleanupModalBackdrops();
            });
        }
        
        // ÈÄÄÂÆ§„É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫„Åô„ÇãÈñ¢Êï∞
        function showExitModal(messageData) {
            // „É¢„Éº„ÉÄ„É´Ë°®Á§∫Ââç„Å´ËÉåÊôØ„Çí„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
            cleanupModalBackdrops();
            
            const exitModal = document.getElementById('exitModal');
            if (!exitModal) return;
            
            const senderName = document.getElementById('exit-sender-name');
            const timeElement = document.getElementById('exit-time');
            const gotoButton = document.getElementById('exit-goto-chat');
            
            if (senderName) senderName.textContent = messageData.sender_name;
            if (timeElement) timeElement.textContent = new Date().toLocaleTimeString();
            
            if (gotoButton) {
                // Âè§„ÅÑ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíÂâäÈô§„Åó„Å¶„Åã„ÇâÊñ∞„Åó„ÅÑ„ÇÇ„ÅÆ„ÇíËøΩÂä†ÔºàÈáçË§áÈò≤Ê≠¢Ôºâ
                gotoButton.replaceWith(gotoButton.cloneNode(true));
                const newGotoButton = document.getElementById('exit-goto-chat');
                
                newGotoButton.addEventListener('click', function() {
                    // „É™„É≥„ÇØÂÖà„Å´ÁßªÂãï„Åô„ÇãÂâç„Å´„É¢„Éº„ÉÄ„É´ËÉåÊôØ„ÇíÂâäÈô§
                    cleanupModalBackdrops();
                    window.location.href = `/chats/${messageData.conversation_id}/`;
                });
            }
            
            // Èñâ„Åò„Çã„Éú„Çø„É≥
            const closeButton = exitModal.querySelector('.btn-secondary');
            if (closeButton) {
                closeButton.addEventListener('click', function() {
                    setTimeout(cleanupModalBackdrops, 100);
                });
            }
            
            // x„Éú„Çø„É≥
            const xButton = exitModal.querySelector('.btn-close');
            if (xButton) {
                xButton.addEventListener('click', function() {
                    setTimeout(cleanupModalBackdrops, 100);
                });
            }
            
            const modal = new bootstrap.Modal(exitModal);
            modal.show();
            
            // „É¢„Éº„ÉÄ„É´„ÅåÈñâ„Åò„Çâ„Çå„ÅüÊôÇ„ÅÆ„Ç§„Éô„É≥„Éà
            exitModal.addEventListener('hidden.bs.modal', function() {
                setTimeout(cleanupModalBackdrops, 100);
            });
        }
    });
    </script>
    {% endif %}

    <script>
    // „Éó„É≠„Éï„Ç£„Éº„É´„Çø„Éñ„ÅÆÂà∂Âæ°
    document.addEventListener('DOMContentLoaded', function() {
        const profileButton = document.getElementById('profile-button');
        const profileTabs = document.getElementById('profile-tabs');
        const profileTabClose = document.getElementById('profile-tab-close');
        
        if (profileButton && profileTabs && profileTabClose) {
            // „Éó„É≠„Éï„Ç£„Éº„É´„Éú„Çø„É≥„ÇØ„É™„ÉÉ„ÇØ„Åß„Çø„Éñ„ÇíË°®Á§∫
            profileButton.addEventListener('click', function(e) {
                e.preventDefault();
                profileTabs.style.display = 'block';
            });
            
            // Èñâ„Åò„Çã„Éú„Çø„É≥„Åß„Çø„Éñ„ÇíÈùûË°®Á§∫
            profileTabClose.addEventListener('click', function() {
                profileTabs.style.display = 'none';
            });
            
            // „Çø„ÉñÂ§ñ„ÇØ„É™„ÉÉ„ÇØ„ÅßÈùûË°®Á§∫
            document.addEventListener('click', function(e) {
                if (!profileTabs.contains(e.target) && e.target !== profileButton && !profileButton.contains(e.target)) {
                    profileTabs.style.display = 'none';
                }
            });
        }
    });
    </script>

</body>
</html>
{% extends 'base.html' %}
{% load app_filters %}
{% load static %}

{# ãƒŠãƒ“ãƒãƒ¼ã‚’å®Œå…¨ã«éè¡¨ç¤ºã«ã™ã‚‹ #}
{% block navbar %}
{% endblock %}

{# ãƒ‡ãƒãƒƒã‚°ç”¨ #}
{{ hide_navbar|default:"not set" }}

{% block content %}
<!-- ã‚µã‚¤ãƒãƒ¼ãƒ‘ãƒ³ã‚¯é¢¨ã®è£…é£¾ -->
<div class="cyber-background position-fixed w-100 h-100" style="top: 0; left: 0; z-index: -1;">
    <div class="cyber-grid"></div>
</div>

<!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
<div id="appTabs" class="app-tabs">
    <div class="container py-1">
        <nav class="nav nav-pills nav-fill mt-0">
            <!-- ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹ãƒ­ãƒœãƒƒãƒˆã‚¢ã‚¤ã‚³ãƒ³ -->
            <a href="{% url 'home:home' %}" class="nav-link" title="ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹">
                <span class="fs-4 me-2 cyber-emoji">ğŸ¤–</span>
            </a>
            
            <a class="nav-link text-neon" data-bs-target="#screenshots" href="#screenshots">
                <i class="bi bi-image-fill"></i> ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ
            </a>
            <a class="nav-link text-neon" data-bs-target="#basic" href="#basic">
                <i class="bi bi-info-circle-fill"></i> åŸºæœ¬æƒ…å ±
            </a>
            <a class="nav-link text-neon" data-bs-target="#appeal" href="#appeal">
                <i class="bi bi-stars"></i> ã‚¢ãƒ—ãƒªã®é­…åŠ›
            </a>
        </nav>
    </div>
</div>

<!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
<div class="container main-content">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼éƒ¨åˆ†ï¼ˆæ–°è¦ä½œæˆ/ç·¨é›†/è©³ç´°ã§åˆ‡ã‚Šæ›¿ãˆï¼‰ -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 style="color: {% if not readonly %}#00ff9f{% else %}#00ffff{% endif %}; 
                   text-shadow: 0 0 10px {% if not readonly %}#00ff9f{% else %}#00ffff{% endif %}, 
                              0 0 20px {% if not readonly %}#00ff9f{% else %}#00ffff{% endif %}; 
                   font-weight: bold;">
            {% if app.id %}
                {% if readonly %}
                    {{ app.title }}ã®è©³ç´°
                {% else %}
                    {{ app.title }}ã‚’ç·¨é›†
                {% endif %}
            {% else %}
                æ–°ã—ã„ã‚¢ãƒ—ãƒªã‚’ç™»éŒ²
            {% endif %}
        </h2>
    </div>

    <!-- ãƒ•ã‚©ãƒ¼ãƒ é–‹å§‹ï¼ˆç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã®æ™‚ã®ã¿ï¼‰ -->
    {% if not readonly %}
        <form id="appForm" 
              method="post" 
              action="{% if is_edit %}{% url 'apps_gallery:edit' app.id %}{% else %}{% url 'apps_gallery:create' %}{% endif %}"
              data-is-edit="{% if is_edit %}true{% else %}false{% endif %}"
              data-app-id="{{ app.id|default:'' }}"
              enctype="multipart/form-data" 
              class="needs-validation" 
              novalidate>
            {% csrf_token %}
            <input type="hidden" name="active_tab" id="active_tab" value="{{ active_tab }}">
            {% if app.id %}
                <input type="hidden" name="app_id" value="{{ app.id }}">
            {% endif %}
    {% endif %}

    <!-- å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="row g-4">
        <div class="col-12">
            <!-- ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <section id="screenshots" class="mb-5 scroll-margin-top">
                {% include 'apps_gallery/tabs/01_screenshots_tab.html' %}
            </section>
        </div>

        <div class="col-12">
            <!-- åŸºæœ¬æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <section id="basic" class="mb-5">
                {% include 'apps_gallery/tabs/02_basic_tab.html' %}
            </section>
        </div>

        <div class="col-12">
            <!-- ã‚¢ãƒ—ãƒªã®é­…åŠ›ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <section id="appeal" class="mb-5">
                {% include 'apps_gallery/tabs/03_appeal_tab.html' %}
            </section>
        </div>
    </div>

    <!-- ãƒ•ã‚©ãƒ¼ãƒ çµ‚äº†ï¼ˆç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã®æ™‚ã®ã¿ï¼‰ -->
    {% if not readonly %}
        </form>
    {% endif %}

    <!-- ä¸‹éƒ¨ã®ãƒœã‚¿ãƒ³ã‚°ãƒ«ãƒ¼ãƒ— -->
    <div class="bottom-button-group">
        <!-- ä¸­å¤®ï¼šã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º -->
        <div class="button-container">
            {% if not readonly and app.id %}
                <span class="status-badge editing-status">
                    <i class="bi bi-pencil-square"></i> ç·¨é›†ä¸­
                </span>
            {% elif readonly and app.id %}
                <span class="status-badge viewing-status">
                    <i class="bi bi-eye"></i> è©³ç´°
                </span>
            {% endif %}
        </div>

        <!-- å³ï¼šä¿å­˜ãƒœã‚¿ãƒ³ -->
        <div class="button-container">
            {% if not readonly %}
                <button type="submit" form="appForm" class="btn-cyber-save">
                    <i class="bi bi-save"></i> ä¿å­˜
                </button>
            {% endif %}
        </div>
    </div>

    <!-- ç”»é¢å³å´ã®æŠ€è¡“ã¸ãƒœã‚¿ãƒ³ -->
    {% if app.id %}  <!-- æ–°è¦ä½œæˆæ™‚ã¯è¡¨ç¤ºã—ãªã„ -->
        <div class="side-nav-button right-nav">
            {% if not readonly %}
                <a href="{% url 'apps_gallery:technical_edit' app.id %}" 
                   class="btn-cyber-nav"
                   onclick="saveAndGoToTechnical(event)">
                    æŠ€è¡“ã¸ <i class="bi bi-arrow-right-circle ms-2"></i>
                </a>
            {% else %}
                <a href="{% url 'apps_gallery:technical_detail' app.id %}" 
                   class="btn-cyber-nav">
                    æŠ€è¡“ã¸ <i class="bi bi-arrow-right-circle ms-2"></i>
                </a>
            {% endif %}
        </div>
    {% endif %}
</div>

<!-- ãƒˆãƒ¼ã‚¹ãƒˆè¦ç´ ã‚’ä¿®æ­£ -->
<div class="toast-container position-fixed top-50 start-50 translate-middle" style="z-index: 9999;">
    <div class="toast align-items-center text-white bg-success border-0" id="liveToast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body">
                <i class="bi bi-check-circle me-2"></i>ä¿å­˜ã—ã¾ã—ãŸï¼
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    </div>
</div>

<style>
/* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ãƒãƒ¼ã‚¸ãƒ³ */
.main-content {
    margin-top: 4rem !important;  /* å°‘ã—å°ã•ã */
}

/* ã‚»ã‚¯ã‚·ãƒ§ãƒ³é–“ã®ä½™ç™½ */
section.mb-5 {
    margin-bottom: 5rem !important;  /* ä¸‹ã®ä½™ç™½ã‚’å¤§ãã */
    padding-bottom: 2rem;  /* ä¸‹ã®ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚‚è¿½åŠ  */
}

/* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
@media (max-width: 768px) {  /* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆä»¥ä¸‹ */
    .main-content {
        margin-top: 6rem !important;
    }
}

@media (max-width: 576px) {  /* ã‚¹ãƒãƒ› */
    .main-content {
        margin-top: 8rem !important;
    }
}

/* ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
.app-tabs {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background: rgba(13, 25, 45, 0.9);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    border-bottom: 1px solid rgba(0, 255, 255, 0.2);
    z-index: 999;
    padding-top: 0 !important;  /* ä¸Šéƒ¨ã®ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’0ã« */
    margin-top: 0 !important;   /* ä¸Šéƒ¨ã®ãƒãƒ¼ã‚¸ãƒ³ã‚’0ã« */
    transition: transform 0.3s ease;
}

.app-tabs .container {
    padding-top: 0 !important;  /* ã‚³ãƒ³ãƒ†ãƒŠã®ä¸Šéƒ¨ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’0ã« */
    margin-top: 0 !important;   /* ã‚³ãƒ³ãƒ†ãƒŠã®ä¸Šéƒ¨ãƒãƒ¼ã‚¸ãƒ³ã‚’0ã« */
}

.nav-pills {
    padding-top: 0 !important;  /* ãƒŠãƒ“ã®ä¸Šéƒ¨ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’0ã« */
    margin-top: 0 !important;   /* ãƒŠãƒ“ã®ä¸Šéƒ¨ãƒãƒ¼ã‚¸ãƒ³ã‚’0ã« */
}

/* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ™‚ã®ã‚¹ãƒ ãƒ¼ã‚ºãªå‹•ã */
html {
    scroll-behavior: smooth;
    scroll-padding-top: 60px; /* ã‚¿ãƒ–ã®é«˜ã•ã«åˆã‚ã›ã¦èª¿æ•´ */
}

/* ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ãƒ–ã®ã‚¹ã‚¿ã‚¤ãƒ« */
.nav-link.active {
    background-color: rgba(0, 255, 255, 0.2) !important;
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
}

/* ã‚µã‚¤ãƒãƒ¼ãƒ‘ãƒ³ã‚¯ãªèƒŒæ™¯ */
.cyber-background {
    background: linear-gradient(45deg, #001e54, #0066cc);
}

/* ç·¨é›†ãƒ¢ãƒ¼ãƒ‰æ™‚ã®èƒŒæ™¯è‰²ã‚’å¤‰æ›´ */
{% if not readonly %}
    {% if app %}
    .cyber-background {
        background: linear-gradient(45deg, #003322, #006644);
    }

    .cyber-grid {
        background-image: 
            linear-gradient(rgba(0,255,100,0.2) 1px, transparent 1px),
            linear-gradient(90deg, rgba(0,255,100,0.2) 1px, transparent 1px);
    }
    {% else %}
    /* æ–°è¦ä½œæˆæ™‚ã®èƒŒæ™¯è‰² */
    .cyber-background {
        background: linear-gradient(45deg, #1a1a3a, #4a1a4a);
    }

    .cyber-grid {
        background-image: 
            linear-gradient(rgba(255,0,255,0.2) 1px, transparent 1px),
            linear-gradient(90deg, rgba(0,255,255,0.2) 1px, transparent 1px);
    }
    {% endif %}
{% else %}
.cyber-grid {
    background-image: 
        linear-gradient(rgba(0,255,255,0.2) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0,255,255,0.2) 1px, transparent 1px);
}
{% endif %}

.cyber-grid {
    background-size: 20px 20px;
    width: 100%;
    height: 100%;
    animation: gridGlow 4s ease-in-out infinite;
}

@keyframes gridGlow {
    0% { opacity: 0.5; }
    50% { opacity: 0.8; }
    100% { opacity: 0.5; }
}

/* ã‚«ãƒ©ãƒ¼ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã®å¤‰æ•°å®šç¾© */
:root {
    --cyber-blue: #00ffff;
    --cyber-orange: #ff8c00;
    --cyber-yellow: #ffd700;
    --cyber-green: #00ff9f;
    --cyber-red: #ff2d55;
    --cyber-purple: #bf5fff;
}

/* ã‚«ãƒ¼ãƒ‰å…¨ä½“ã®ã‚¹ã‚¿ã‚¤ãƒ« */
.card {
    background: rgba(13, 25, 45, 0.8) !important;
}

/* ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã®ã‚¹ã‚¿ã‚¤ãƒ«ä¿®æ­£ */
.form-control,
.form-select {
    background-color: rgba(0, 20, 50, 0.5) !important;
    border: 1px solid rgba(0, 255, 255, 0.3);
}

.form-control:focus,
.form-select:focus {
    background-color: rgba(0, 30, 70, 0.7);
    border-color: #0ff;
    box-shadow: 0 0 15px rgba(0,255,255,0.4);
}

/* èª­ã¿å–ã‚Šå°‚ç”¨ãƒ»ç„¡åŠ¹åŒ–çŠ¶æ…‹ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ä¿®æ­£ */
.form-control[readonly],
.form-select[readonly],
.form-control:disabled,
.form-select:disabled {
    background-color: rgba(0, 20, 50, 0.5) !important;
    border: 1px solid rgba(0, 255, 255, 0.3);
    opacity: 1 !important;  /* é€æ˜åº¦ã‚’1ã«è¨­å®š */
    cursor: default;
}

/* ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã®è‰²ã‚‚èª¿æ•´ */
.form-control::placeholder {
    color: rgba(255, 255, 255, 0.5) !important;
}

/* åŸºæœ¬æƒ…å ±ã‚¿ãƒ–ã®èª­ã¿å–ã‚Šå°‚ç”¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */
#basic .form-control[readonly],
#basic .form-select[readonly],
#basic .form-control:disabled,
#basic .form-select:disabled {
    color: var(--cyber-yellow) !important;
    text-shadow: 0 0 5px var(--cyber-yellow) !important;
    font-weight: 500 !important;
}

/* ã‚¢ãƒ—ãƒªã®é­…åŠ›ã‚¿ãƒ–ã®èª­ã¿å–ã‚Šå°‚ç”¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */
#appeal .form-control[readonly],
#appeal .form-select[readonly],
#appeal .form-control:disabled,
#appeal .form-select:disabled {
    color: var(--cyber-green) !important;
    text-shadow: 0 0 5px var(--cyber-green) !important;
    font-weight: 500 !important;
}

/* ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚¿ãƒ–ã®èª­ã¿å–ã‚Šå°‚ç”¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */
#screenshots .form-control[readonly],
#screenshots .form-select[readonly],
#screenshots .form-control:disabled,
#screenshots .form-select:disabled {
    color: var(--cyber-purple) !important;
    text-shadow: 0 0 5px var(--cyber-purple) !important;
    font-weight: 500 !important;
}

/* ã‚¿ãƒ–ã®ãƒã‚ªãƒ³ãƒ†ã‚­ã‚¹ãƒˆ */
.nav-link.text-neon {
    color: var(--cyber-blue) !important;
    text-shadow: 0 0 5px var(--cyber-blue), 0 0 10px var(--cyber-blue);
}

/* åŸºæœ¬æƒ…å ±ã‚¿ãƒ– */
.nav-link[data-bs-target="#basic"] {
    color: var(--cyber-yellow) !important;
    text-shadow: 0 0 5px var(--cyber-yellow), 0 0 10px var(--cyber-yellow);
}

/* ã‚¢ãƒ—ãƒªã®é­…åŠ›ã‚¿ãƒ– */
.nav-link[data-bs-target="#appeal"] {
    color: var(--cyber-green) !important;
    text-shadow: 0 0 5px var(--cyber-green), 0 0 10px var(--cyber-green);
}

/* ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚¿ãƒ– */
.nav-link[data-bs-target="#screenshots"] {
    color: var(--cyber-purple) !important;
    text-shadow: 0 0 5px var(--cyber-purple), 0 0 10px var(--cyber-purple);
}

/* ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ãƒ–ã®ã‚¹ã‚¿ã‚¤ãƒ« */
.nav-link.active[data-bs-target="#basic"] {
    background-color: rgba(255, 215, 0, 0.2) !important;
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
}

.nav-link.active[data-bs-target="#appeal"] {
    background-color: rgba(0, 255, 159, 0.2) !important;
    box-shadow: 0 0 15px rgba(0, 255, 159, 0.3);
}

.nav-link.active[data-bs-target="#screenshots"] {
    background-color: rgba(191, 95, 255, 0.2) !important;
    box-shadow: 0 0 15px rgba(191, 95, 255, 0.3);
}

/* ãƒ›ãƒãƒ¼æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
.nav-link[data-bs-target="#basic"]:hover {
    background-color: rgba(255, 215, 0, 0.1) !important;
}

.nav-link[data-bs-target="#appeal"]:hover {
    background-color: rgba(0, 255, 159, 0.1) !important;
}

.nav-link[data-bs-target="#screenshots"]:hover {
    background-color: rgba(191, 95, 255, 0.1) !important;
}

/* å„ã‚¿ãƒ–ã®è¦‹å‡ºã—ã®è‰²ã‚’æ˜ç¢ºã« */
#basic .card-title {
    color: var(--cyber-yellow) !important;
    text-shadow: 0 0 5px var(--cyber-yellow), 0 0 10px var(--cyber-yellow);
}

#appeal .card-title {
    color: var(--cyber-green) !important;
    text-shadow: 0 0 5px var(--cyber-green), 0 0 10px var(--cyber-green);
}

#screenshots .card-title {
    color: var(--cyber-purple) !important;
    text-shadow: 0 0 5px var(--cyber-purple), 0 0 10px var(--cyber-purple);
}

/* ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
.btn-cyber {
    background: linear-gradient(45deg, #ff8c00, #ffd700);
    border: none;
    color: #fff;
    text-shadow: 0 0 5px rgba(0,0,0,0.5);
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
    box-shadow: 0 0 15px rgba(255,140,0,0.3);
}

.btn-cyber:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(255,140,0,0.6);
}

.btn-cyber-danger {
    background: linear-gradient(45deg, #ff2d55, #ff0044);
    box-shadow: 0 0 15px rgba(255,45,85,0.3);
}

/* ãã®ä»–ã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆcreate.htmlã¨detail.htmlã‹ã‚‰å¿…è¦ãªã‚‚ã®ã‚’è¿½åŠ ï¼‰ */
// ... rest of the styles from create.html and detail.html ...

/* ã‚¿ã‚¤ãƒˆãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å¼·åŒ– */
.cyber-title {
    color: #fff !important;
    text-shadow: 
        0 0 10px #00ffff,
        0 0 20px #00ffff,
        0 0 30px #00ffff,
        0 0 40px #00ffff;
    font-weight: bold;
    letter-spacing: 1px;
}

/* ã‚µã‚¤ãƒãƒ¼ãƒ‘ãƒ³ã‚¯ãªã‚¹ã‚¿ã‚¤ãƒ« */
.text-cyber-yellow {
    color: var(--cyber-yellow) !important;
    text-shadow: 0 0 5px var(--cyber-yellow);
}

/* ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®è‰²ã‚’é»„è‰²ã«ã€ãƒã‚§ãƒƒã‚¯ãƒãƒ¼ã‚¯ã¯é»’ã« */
.form-check-input:checked {
    background-color: var(--cyber-yellow) !important;
    border-color: var(--cyber-yellow) !important;
    box-shadow: 0 0 5px var(--cyber-yellow);
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'%3e%3cpath fill='none' stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='3' d='m6 10 3 3 6-6'/%3e%3c/svg%3e") !important;
}

.form-check-input:focus {
    border-color: var(--cyber-yellow);
    box-shadow: 0 0 5px var(--cyber-yellow);
}

/* æœªãƒã‚§ãƒƒã‚¯æ™‚ã®ãƒœãƒ¼ãƒ€ãƒ¼ã‚‚é»„è‰²ã« */
.form-check-input {
    border-color: var(--cyber-yellow);
}

/* ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãŒç„¡åŠ¹ã§ãƒã‚§ãƒƒã‚¯æ¸ˆã¿ã®å ´åˆã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ä¿®æ­£ */
.cyber-checkbox:disabled:checked {
    background-color: var(--cyber-yellow) !important;
    border-color: var(--cyber-yellow) !important;
    box-shadow: 0 0 15px var(--cyber-yellow);
    opacity: 1 !important;
}

/* ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãŒç„¡åŠ¹ã§ãƒã‚§ãƒƒã‚¯æ¸ˆã¿ã®å ´åˆã®ãƒ©ãƒ™ãƒ«ã‚’ä¿®æ­£ */
.cyber-checkbox:disabled:checked + .form-check-label {
    color: var(--cyber-yellow) !important;
    text-shadow: 0 0 5px var(--cyber-yellow);
    font-weight: bold;
    opacity: 1 !important;
    letter-spacing: 0.5px;
}

/* ç„¡åŠ¹åŒ–ã•ã‚ŒãŸãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®ãƒ©ãƒ™ãƒ«ã‚‚è¦‹ã‚„ã™ã */
.cyber-checkbox:disabled + .form-check-label {
    opacity: 1 !important;
    color: var(--cyber-yellow) !important;
}

/* ä¿å­˜ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
.btn-cyber-save {
    background: rgba(0, 255, 159, 0.1);  /* ç·‘è‰²ã®ã‚¹ã‚±ãƒ«ãƒˆãƒ³èƒŒæ™¯ */
    color: #00ff9f;  /* ã‚µã‚¤ãƒãƒ¼ç·‘è‰²ã®ãƒ†ã‚­ã‚¹ãƒˆ */
    border: 2px solid #00ff9f;  /* ç·‘è‰²ã®ãƒœãƒ¼ãƒ€ãƒ¼ */
    text-shadow: 0 0 5px #00ff9f;  /* ãƒ†ã‚­ã‚¹ãƒˆã®å…‰ã‚‹åŠ¹æœ */
    padding: 10px 30px;
    font-weight: bold;
    transition: all 0.3s ease;
    border-radius: 25px;
    box-shadow: 0 0 15px rgba(0, 255, 159, 0.3);  /* ç·‘è‰²ã®å…‰ã‚‹åŠ¹æœ */
    font-size: 1.1rem;
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
}

.btn-cyber-save:hover {
    background: rgba(0, 255, 159, 0.2);  /* ãƒ›ãƒãƒ¼æ™‚ã¯å°‘ã—æ¿ƒã */
    box-shadow: 0 0 20px rgba(0, 255, 159, 0.5);  /* ãƒ›ãƒãƒ¼æ™‚ã¯å…‰ã‚’ã‚ˆã‚Šå¼·ã */
    transform: translateY(-2px);
}

.btn-cyber-save:active {
    transform: translateY(1px);
}

/* ãƒœã‚¿ãƒ³ã‚°ãƒ«ãƒ¼ãƒ—ã®ã‚³ãƒ³ãƒ†ãƒŠ */
.bottom-button-group {
    position: fixed;
    bottom: 20px;
    left: 0;
    right: 0;
    display: flex;
    justify-content: space-between;
    padding: 0 20px;
    z-index: 1000;
}

/* å„ãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ */
.button-container {
    flex: 1;
    display: flex;
    justify-content: center;
    max-width: 250px;
}

/* å·¦ã®ãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ */
.button-container:first-child {
    justify-content: flex-start;
}

/* å³ã®ãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ */
.button-container:last-child {
    justify-content: flex-end;
}

/* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸ã®ã‚¹ã‚¿ã‚¤ãƒ« */
.status-badge {
    display: inline-flex;  /* ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒ•ãƒ¬ãƒƒã‚¯ã‚¹ã«å¤‰æ›´ */
    align-items: center;   /* ã‚¢ã‚¤ã‚³ãƒ³ã¨æ–‡å­—ã‚’ä¸­å¤®æƒãˆ */
    padding: 8px 25px;
    border-radius: 25px;
    font-weight: bold;
    background: rgba(0, 255, 159, 0.1);  /* ã‚¹ã‚±ãƒ«ãƒˆãƒ³èƒŒæ™¯ */
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
}

/* ç·¨é›†ãƒ¢ãƒ¼ãƒ‰æ™‚ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º */
.status-badge.editing-status {
    color: #00ff9f;
    border: 2px solid #00ff9f;
    text-shadow: 0 0 5px #00ff9f;
    box-shadow: 0 0 15px rgba(0, 255, 159, 0.3);
}

/* ã‚¢ã‚¤ã‚³ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
.status-badge i {
    margin-right: 8px;  /* ã‚¢ã‚¤ã‚³ãƒ³ã¨æ–‡å­—ã®é–“éš”ã‚’èª¿æ•´ */
}

/* è©³ç´°ãƒ¢ãƒ¼ãƒ‰æ™‚ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º */
.status-badge.viewing-status {
    color: #00ffff;
    border: 2px solid #00ffff;
    text-shadow: 0 0 5px #00ffff;
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
    background: #000000;  /* é»’åœ°ã®èƒŒæ™¯ã‚’æ˜ç¤ºçš„ã«æŒ‡å®š */
}

/* æ—¢å­˜ã®ãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ« */
.btn-cyber-mode-switch {
    padding: 10px 20px;
    border-radius: 25px;
    font-weight: bold;
    text-decoration: none;
}

/* è©³ç´°ã¸ãƒœã‚¿ãƒ³ - é’è‰² */
#btn-to-detail {
    background: rgba(0, 255, 255, 0.1);
    color: #00ffff;
    border: 2px solid #00ffff;
    text-shadow: 0 0 5px #00ffff;
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
}

#btn-to-detail:hover {
    background: rgba(0, 255, 255, 0.2);
    color: #00ffff;
    transform: translateY(-2px);
}

/* ç·¨é›†ã¸ãƒœã‚¿ãƒ³ - ç·‘è‰² */
#btn-to-edit {
    background: rgba(0, 255, 159, 0.1);
    color: #00ff9f;
    border: 2px solid #00ff9f;
    text-shadow: 0 0 5px #00ff9f;
    box-shadow: 0 0 15px rgba(0, 255, 159, 0.3);
}

#btn-to-edit:hover {
    background: rgba(0, 255, 159, 0.2);
    color: #00ff9f;
    transform: translateY(-2px);
}

/* æŠ€è¡“åŸºç›¤ç·¨ã‚¿ãƒ– */
.nav-link[href*="technical_edit"] {
    color: var(--cyber-blue) !important;
    text-shadow: 0 0 5px var(--cyber-blue), 0 0 10px var(--cyber-blue);
}

.nav-link[href*="technical_edit"]:hover {
    background-color: rgba(0, 255, 255, 0.1) !important;
}

/* æŠ€è¡“åŸºç›¤ç·¨ã¸ã®é·ç§»ãƒœã‚¿ãƒ³ */
.technical-transition-btn {
    color: var(--cyber-blue) !important;
    text-shadow: 0 0 5px var(--cyber-blue) !important;
    transition: all 0.3s ease;
    background: rgba(0, 255, 255, 0.1) !important;
    border: 1px solid rgba(0, 255, 255, 0.3) !important;
}

.technical-transition-btn:hover {
    background: rgba(0, 255, 255, 0.2) !important;
    transform: translateY(-1px);
    box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
}

/* ã‚°ãƒªãƒƒãƒã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’å‰Šé™¤ */
.cyber-glitch-effect {
    display: none;
}

/* ã‚¢ã‚¤ã‚³ãƒ³ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
.technical-transition-btn i {
    margin-right: 0.5rem;
    animation: bounce 1s infinite;
}

@keyframes bounce {
    0%, 100% {
        transform: translateX(0);
    }
    50% {
        transform: translateX(3px);
    }
}

/* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
@media (max-width: 768px) {
    .technical-transition-btn {
        margin-top: 0.5rem !important;
        margin-left: 0 !important;
    }
}

/* ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ä¿®æ­£ */
.cyber-dialog-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(5px);
    z-index: 9999;
    display: flex;
    justify-content: center;  /* æ°´å¹³æ–¹å‘ã®ä¸­å¤®æƒãˆ */
    align-items: center;      /* å‚ç›´æ–¹å‘ã®ä¸­å¤®æƒãˆ */
}

.cyber-message {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
    background: rgba(13, 25, 45, 0.95);
    border: 2px solid var(--cyber-blue);
    box-shadow: 0 0 20px var(--cyber-blue);
    max-width: 500px;        /* æœ€å¤§å¹…ã‚’è¨­å®š */
    width: 90%;             /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
    position: relative;      /* ä½ç½®ã‚’ç›¸å¯¾æŒ‡å®š */
    margin: auto;           /* è‡ªå‹•ãƒãƒ¼ã‚¸ãƒ³ã§ä¸­å¤®æƒãˆ */
}

.message-icon {
    font-size: 24px;
    margin-bottom: 15px;  /* ä¸‹éƒ¨ã«ãƒãƒ¼ã‚¸ãƒ³ã‚’è¿½åŠ  */
    color: var(--cyber-blue);
    text-shadow: 0 0 10px var(--cyber-blue);
}

.message-content {
    margin-bottom: 30px;  /* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ãƒœã‚¿ãƒ³ã®é–“éš”ã‚’åºƒã’ã‚‹ */
    text-align: center;
}

.message-text {
    color: #ffffff;
    font-size: 16px;
    text-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
}

.cyber-dialog-buttons {
    display: flex;
    gap: 10px;
    justify-content: center;
    width: 100%;
}

.cyber-button {
    background: transparent;
    border: 2px solid var(--cyber-blue);
    color: var(--cyber-blue);
    padding: 10px 30px;
    font-size: 16px;
    cursor: pointer;
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
    text-shadow: 0 0 5px var(--cyber-blue);
    margin-top: 10px;
    text-decoration: none;
    display: inline-block;
}

.cyber-button:hover {
    background: rgba(0, 255, 255, 0.1);
    box-shadow: 0 0 15px var(--cyber-blue);
}

.cyber-button.save-dialog {
    background: rgba(255, 215, 0, 0.1);
    border-color: var(--cyber-yellow);
    color: var(--cyber-yellow);
    text-shadow: 0 0 5px var(--cyber-yellow);
}

.cyber-button.save-dialog:hover {
    background: rgba(255, 215, 0, 0.2);
    box-shadow: 0 0 15px var(--cyber-yellow);
}

.cyber-button.cancel-dialog {
    background: rgba(128, 128, 128, 0.1);
    border-color: #808080;
    color: #808080;
    text-shadow: 0 0 5px #808080;
}

.cyber-button.cancel-dialog:hover {
    background: rgba(128, 128, 128, 0.2);
    box-shadow: 0 0 15px rgba(128, 128, 128, 0.3);
}

@keyframes glitch {
    0% { transform: translate(0); }
    20% { transform: translate(-2px, 2px); }
    40% { transform: translate(-2px, -2px); }
    60% { transform: translate(2px, 2px); }
    80% { transform: translate(2px, -2px); }
    100% { transform: translate(0); }
}

/* ã‚µã‚¤ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
.side-nav-button {
    position: fixed;
    top: 50%;
    transform: translateY(-50%);
    z-index: 1000;
}

.left-nav {
    left: 20px;
}

.right-nav {
    right: 20px;
}

.btn-cyber-nav {
    display: inline-flex;
    align-items: center;
    padding: 10px 20px;
    background: rgba(0, 255, 159, 0.1);  /* ã‚¹ã‚±ãƒ«ãƒˆãƒ³èƒŒæ™¯ */
    border: 2px solid #00ff9f;  /* ãƒœãƒ¼ãƒ€ãƒ¼ã‚’å°‘ã—å¤ªã */
    color: #00ff9f;
    text-decoration: none;
    border-radius: 25px;  /* ã‚ˆã‚Šä¸¸ã¿ã‚’æŒãŸã›ã‚‹ */
    transition: all 0.3s ease;
    box-shadow: 0 0 10px rgba(0, 255, 159, 0.3);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    font-weight: bold;  /* ãƒ†ã‚­ã‚¹ãƒˆã‚’å¤ªã */
    text-shadow: 0 0 5px #00ff9f;  /* ãƒ†ã‚­ã‚¹ãƒˆã‚’å…‰ã‚‰ã›ã‚‹ */
}

.btn-cyber-nav:hover {
    background: rgba(0, 255, 159, 0.2);
    color: #fff;
    box-shadow: 0 0 20px rgba(0, 255, 159, 0.5);
    transform: scale(1.05);
    text-decoration: none;
}

/* ãƒ›ãƒãƒ¼æ™‚ã®ã‚°ãƒªãƒƒãƒã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
.btn-cyber-nav:hover::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 255, 159, 0.2);  /* ç·‘è‰²ã«å¤‰æ›´ */
    animation: glitch 0.3s infinite;
}

@keyframes glitch {
    0% { transform: translate(0); }
    20% { transform: translate(-2px, 2px); }
    40% { transform: translate(-2px, -2px); }
    60% { transform: translate(2px, 2px); }
    80% { transform: translate(2px, -2px); }
    100% { transform: translate(0); }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('appForm');
    const toastEl = document.getElementById('liveToast');
    
    // ãƒˆãƒ¼ã‚¹ãƒˆã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¨­å®š
    const toastOptions = {
        animation: true,
        autohide: true,  // è‡ªå‹•ã§éè¡¨ç¤º
        delay: 2000      // 2ç§’å¾Œã«æ¶ˆãˆã‚‹
    };
    
    // Bootstrapãƒˆãƒ¼ã‚¹ãƒˆã®åˆæœŸåŒ–
    const toast = new bootstrap.Toast(toastEl, toastOptions);

    // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒURLã«ã‚ã‚‹å ´åˆã®ã¿ãƒˆãƒ¼ã‚¹ãƒˆã‚’è¡¨ç¤º
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.has('success')) {
        // ãƒˆãƒ¼ã‚¹ãƒˆã‚’è¡¨ç¤º
        toast.show();
        
        // URLã‹ã‚‰success=trueãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‰Šé™¤
        window.history.replaceState({}, '', window.location.pathname);
        
        // 2ç§’å¾Œã«å¼·åˆ¶çš„ã«éè¡¨ç¤º
        setTimeout(() => {
            toast.hide();
            // DOMã‹ã‚‰ãƒˆãƒ¼ã‚¹ãƒˆè¦ç´ ã‚’å®Œå…¨ã«å‰Šé™¤
            toastEl.remove();
        }, 2000);
    }

    if (form) {
        form.addEventListener('submit', function(e) {
            // ãƒ•ã‚©ãƒ¼ãƒ ã®é€šå¸¸ã®é€ä¿¡ã‚’è¨±å¯
            return true;
        });
    }

    // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢
    if (window.performance && window.performance.navigation.type === window.performance.navigation.TYPE_BACK_FORWARD) {
        window.location.reload(true);  // å¼·åˆ¶çš„ã«ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿
    }
});

// ãƒãƒƒã‚¯ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥å¯¾ç­–ã‚’å¼·åŒ–
window.addEventListener('pageshow', function(event) {
    if (event.persisted || 
        (window.performance && 
         window.performance.navigation.type === window.performance.navigation.TYPE_BACK_FORWARD)) {
        window.location.reload(true);  // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç„¡è¦–ã—ã¦å†èª­ã¿è¾¼ã¿
    }
});

// ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‡¦ç†ã‚’åŒæœŸçš„ãªæ–¹æ³•ã«å¤‰æ›´
function saveAndGoToTechnical(event) {
    event.preventDefault();
    console.log('saveAndGoToTechnicalé–‹å§‹');
    
    const form = document.getElementById('appForm');
    if (!form) {
        console.error('ãƒ•ã‚©ãƒ¼ãƒ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
        return;
    }

    // ç¾åœ¨ã®URLã‹ã‚‰æ­£ã—ã„ãƒ‘ã‚¹ã‚’æ§‹ç¯‰
    const currentPath = window.location.pathname;
    const appId = currentPath.split('/')[3];  // /apps_gallery/edit/13/ ã‹ã‚‰13ã‚’å–å¾—
    const technicalUrl = `/apps_gallery/edit/${appId}/technical/`;
    
    console.log('é·ç§»å…ˆURL:', technicalUrl);

    // ãƒ•ã‚©ãƒ¼ãƒ ã®è¨­å®š
    form.action = currentPath;  // ç¾åœ¨ã®URLã‚’ä½¿ç”¨
    form.method = 'POST';

    // é·ç§»å…ˆURLã‚’hiddenãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ã—ã¦è¿½åŠ 
    const nextUrlInput = document.createElement('input');
    nextUrlInput.type = 'hidden';
    nextUrlInput.name = 'next_url';
    nextUrlInput.value = technicalUrl;
    form.appendChild(nextUrlInput);

    // ãƒ‡ãƒãƒƒã‚°å‡ºåŠ›
    console.log('ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å…ˆ:', form.action);
    console.log('é·ç§»å…ˆURL:', technicalUrl);

    // ãƒ•ã‚©ãƒ¼ãƒ ã‚’é€ä¿¡
    form.submit();
}

// CSRFãƒˆãƒ¼ã‚¯ãƒ³å–å¾—
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// ãƒãƒƒã‚¯ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥å¯¾ç­–
window.addEventListener('pageshow', function(event) {
    if (event.persisted) {
        window.location.reload();
    }
});

// ãƒ•ã‚©ãƒ¼ãƒ ã®åˆæœŸåŒ–
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('appForm');
    if (form) {
        // ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®é€ä¿¡ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
        form.addEventListener('submit', function(e) {
            if (!e.submitter || !e.submitter.classList.contains('save-and-continue')) {
                return true;  // é€šå¸¸ã®é€ä¿¡ã¯è¨±å¯
            }
            e.preventDefault();  // save-and-continueã®å ´åˆã®ã¿ preventDefault
        });
    }
});
</script>

<!-- Bootstrapã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    if (typeof bootstrap === 'undefined') {
        console.error('BootstrapãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“ï¼');
    } else {
        console.log('Bootstrapèª­ã¿è¾¼ã¿å®Œäº†');
    }
});
</script>
{% endblock %} 
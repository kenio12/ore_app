{% extends 'base.html' %}
{% load static %}

{# ナビバーを完全に非表示にする #}
{% block navbar %}
{% endblock %}

{% block content %}
<!-- サイバーテーマのCSS読み込み -->
<link rel="stylesheet" href="{% static 'apps_gallery/css/cyber-theme.css' %}">

<!-- サイバーパンク風の装飾 -->
<div class="cyber-background position-fixed w-100 h-100" style="top: 0; left: 0; z-index: -1;">
    <div class="cyber-grid"></div>
</div>

<!-- メインコンテンツ -->
<div id="app-view-detail" class="container mt-4">
    <!-- ヘッダー -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="cyber-title" style="color: var(--cyber-purple) !important; 
                                     text-shadow: 0 0 10px var(--cyber-purple),
                                                0 0 20px var(--cyber-purple);
                                     font-weight: bold;">
            {{ app.title }}の詳細
        </h2>
    </div>

    <!-- タブナビゲーション -->
    <div id="appTabs" class="app-tabs">
        <div class="container py-1">
            <nav class="nav nav-pills nav-fill m-0">
                <!-- ホームへ戻るボタン -->
                <a href="/" class="nav-link cyber-home" title="ホームへ戻る">
                    <span class="fs-4 me-2 cyber-emoji">&#x1F916;</span>
                </a>
                
                <a class="nav-link text-neon" href="#screenshots-section" style="color: var(--cyber-purple) !important; text-shadow: 0 0 5px var(--cyber-purple);">
                    <i class="bi bi-image-fill"></i> スクリーンショット
                </a>
                <a class="nav-link text-neon" href="#basic-section" style="color: var(--cyber-gold) !important; text-shadow: 0 0 5px var(--cyber-gold);">
                    <i class="bi bi-info-circle-fill"></i> 基本情報
                </a>
                <a class="nav-link text-neon" href="#appeal-section" style="color: var(--cyber-green) !important; text-shadow: 0 0 5px var(--cyber-green);">
                    <i class="bi bi-star-fill"></i> アプリの魅力
                </a>
                <a class="nav-link text-neon" href="#hardware-section" style="color: var(--cyber-blue) !important; text-shadow: 0 0 5px var(--cyber-blue);">
                    <i class="bi bi-pc-display"></i> パソコン環境
                </a>
                <a class="nav-link text-neon" href="#dev-env-section" style="color: var(--cyber-orange) !important; text-shadow: 0 0 5px var(--cyber-orange);">
                    <i class="bi bi-tools"></i> 開発環境
                </a>
                <a class="nav-link text-neon" href="#architecture-section" style="color: var(--cyber-lime) !important; text-shadow: 0 0 5px var(--cyber-lime);">
                    <i class="bi bi-diagram-3-fill"></i> アーキテクチャ
                </a>
                <a class="nav-link text-neon" href="#backend-section" style="color: var(--cyber-aqua) !important; text-shadow: 0 0 5px var(--cyber-aqua);">
                    <i class="bi bi-server"></i> バックエンド
                </a>
                <a class="nav-link text-neon" href="#frontend-section" style="color: var(--cyber-pink) !important; text-shadow: 0 0 5px var(--cyber-pink);">
                    <i class="bi bi-window"></i> フロントエンド
                </a>
                <a class="nav-link text-neon" href="#database-section" style="color: var(--cyber-emerald) !important; text-shadow: 0 0 5px var(--cyber-emerald);">
                    <i class="bi bi-database-fill"></i> データベース
                </a>
                <a class="nav-link text-neon" href="#security-section" style="color: var(--cyber-red) !important; text-shadow: 0 0 5px var(--cyber-red);">
                    <i class="bi bi-shield-fill-check"></i> セキュリティ
                </a>
                <a class="nav-link text-neon" href="#development-section" style="color: var(--cyber-yellow) !important; text-shadow: 0 0 5px var(--cyber-yellow);">
                    <i class="bi bi-journal-text"></i> 開発ストーリー
                </a>
            </nav>
        </div>
    </div>

    <!-- 各セクション -->
    <div id="screenshots-section" class="section mb-5">
        {% include 'apps_gallery/tabs/01_screenshots_tab.html' %}
    </div>

    <div id="basic-section" class="section mb-5">
        {% include 'apps_gallery/tabs/02_basic_tab.html' %}
    </div>

    <div id="appeal-section" class="section mb-5">
        {% include 'apps_gallery/tabs/03_appeal_tab.html' %}
    </div>

    <!-- ハードウェア情報 -->
    <div id="hardware-section" class="section mb-5">
        {% include 'apps_gallery/technical/tabs/04_hardware_tab.html' %}
    </div>

    <!-- 開発環境 -->
    <div id="dev-env-section" class="section mb-5">
        {% include 'apps_gallery/technical/tabs/05_dev_env_tab.html' %}
    </div>

    <!-- アーキテクチャ -->
    <div id="architecture-section" class="section mb-5">
        {% include 'apps_gallery/technical/tabs/06_architecture_tab.html' %}
    </div>

    <!-- バックエンド -->
    <div id="backend-section" class="section mb-5">
        {% include 'apps_gallery/technical/tabs/07_backend_tab.html' %}
    </div>

    <!-- フロントエンド -->
    <div id="frontend-section" class="section mb-5">
        {% include 'apps_gallery/technical2/tabs/08_frontend_tab.html' %}
    </div>

    <!-- データベース -->
    <div id="database-section" class="section mb-5">
        {% include 'apps_gallery/technical2/tabs/09_database_tab.html' %}
    </div>

    <!-- セキュリティ -->
    <div id="security-section" class="section mb-5">
        {% include 'apps_gallery/technical2/tabs/10_security_tab.html' %}
    </div>

    <!-- 開発ストーリー -->
    <div id="development-section" class="section mb-5">
        {% include 'apps_gallery/technical2/tabs/11_development_tab.html' %}
    </div>

    <!-- デバッグ用の表示を追加 -->
    <div style="display: none;">
        <p>Debug Info:</p>
        <p>PC Type: {{ app.hardware_specs.pc_type }}</p>
        <p>Device Type: {{ app.hardware_specs.device_type }}</p>
        <p>CPU Type: {{ app.hardware_specs.cpu_type }}</p>
        <p>Memory Size: {{ app.hardware_specs.memory_size }}</p>
        <p>Storage Type: {{ app.hardware_specs.storage_type }}</p>
        <p>Monitor Count: {{ app.hardware_specs.monitor_count }}</p>
        <p>Internet Type: {{ app.hardware_specs.internet_type }}</p>
    </div>
</div>

<style>
/* サイバーパンクな背景 */
.cyber-background {
    background: linear-gradient(45deg, #001e54, #0066cc);
}

.cyber-grid {
    background-image: 
        linear-gradient(rgba(0,255,255,0.2) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0,255,255,0.2) 1px, transparent 1px);
    background-size: 20px 20px;
    width: 100%;
    height: 100%;
    animation: gridGlow 4s ease-in-out infinite;
}

@keyframes gridGlow {
    0% { opacity: 0.5; }
    50% { opacity: 0.8; }
    100% { opacity: 0.5; }
}

/* タブナビゲーションの背景 */
.app-tabs {
    background: rgba(13, 25, 45, 0.95) !important;
    backdrop-filter: blur(10px) !important;
    -webkit-backdrop-filter: blur(10px) !important;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
    position: sticky !important;
    top: 0 !important;
    z-index: 1000 !important;
    transition: transform 0.3s ease !important;
    margin-bottom: 2rem !important;  /* タブと下のセクションの間隔を追加 */
}

/* タブのスタイル */
.nav-link {
    padding: 1rem 0.5rem !important;  /* 左右の余白を縮小 */
    transition: all 0.3s ease !important;
    font-weight: bold !important;
    border-radius: 0.5rem !important;
    color: inherit !important;
    text-shadow: 0 0 5px currentColor !important;
}

.nav-link:hover {
    transform: translateY(-2px) !important;
    background: rgba(255, 255, 255, 0.1) !important;
}

.nav-link.active {
    background: rgba(255, 255, 255, 0.15) !important;
    box-shadow: 0 0 15px currentColor !important;
}

/* スクロール時のタブ非表示 */
.app-tabs.hidden {
    transform: translateY(-100%) !important;
}

/* メインコンテンツのマージン調整 */
#app-view-detail {
    margin-top: 4rem !important;
}

/* レスポンシブ対応 */
@media (max-width: 768px) {
    #app-view-detail {
        margin-top: 6rem !important;
    }
}

@media (max-width: 576px) {
    #app-view-detail {
        margin-top: 8rem !important;
    }
}
</style>

<!-- スクロール制御用のスクリプト -->
<script>
let lastScrollTop = 0;
const tabsElement = document.getElementById('appTabs');

// スムーズスクロール用の関数を追加
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const targetId = this.getAttribute('href');
        if (targetId === '#') return;
        
        const targetElement = document.querySelector(targetId);
        if (targetElement) {
            // タブメニューの高さを取得
            const tabHeight = document.querySelector('.app-tabs').offsetHeight;
            // 現在のスクロール位置
            const currentPosition = window.pageYOffset;
            // ターゲット要素の位置
            const targetPosition = targetElement.getBoundingClientRect().top + window.pageYOffset;
            
            // 上スクロールの場合はタブの高さ分を考慮、下スクロールの場合は考慮しない
            const offset = currentPosition > targetPosition ? tabHeight + 20 : 0;
            
            window.scrollTo({
                top: targetPosition - offset,
                behavior: 'smooth'
            });
        }
    });
});

// 既存のスクロール監視コード
window.addEventListener('scroll', function() {
    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
    const isScrollingUp = scrollTop < lastScrollTop;
    
    if (scrollTop > 100 && !isScrollingUp) {
        tabsElement.classList.add('hidden');
    } else {
        tabsElement.classList.remove('hidden');
    }
    
    lastScrollTop = scrollTop;
});
</script>

<!-- 既存のスクリプト部分の後に追加 -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // ハードウェア情報の展開
    const hardwareSection = document.getElementById('hardware-section');
    if (hardwareSection) {
        console.log('Hardware section found');
        
        // デバッグ用：値の確認
        const specs = {
            pc_type: "{{ app.hardware_specs.pc_type|default:'' }}",
            device_type: "{{ app.hardware_specs.device_type|default:'' }}",
            cpu_type: "{{ app.hardware_specs.cpu_type|default:'' }}",
            memory_size: "{{ app.hardware_specs.memory_size|default:'' }}",
            storage_type: "{{ app.hardware_specs.storage_type|default:'' }}",
            monitor_count: "{{ app.hardware_specs.monitor_count|default:'' }}",
            internet_type: "{{ app.hardware_specs.internet_type|default:'' }}"
        };
        
        console.log('Hardware specs:', specs);

        // 各ラジオボタンの設定
        Object.entries(specs).forEach(([key, value]) => {
            if (!value) {
                console.log(`Skipping empty value for ${key}`);
                return; // 空の値はスキップ
            }
            
            console.log(`Looking for: ${key} with value: ${value}`);
            const selector = `input[name="hardware_specs[${key}]"][value="${value}"]`;
            console.log('Selector:', selector);
            
            const radioInput = document.querySelector(selector);
            if (radioInput) {
                console.log(`Found radio for ${key}`);
                radioInput.checked = true;
            } else {
                console.log(`Radio not found for ${key}`);
            }
        });

        // メーカーと機種名
        const maker = "{{ app.hardware_specs.maker|default:'' }}";
        const model = "{{ app.hardware_specs.model|default:'' }}";
        
        const makerInput = document.getElementById('maker');
        const modelInput = document.getElementById('model');
        
        if (makerInput && maker) makerInput.value = maker;
        if (modelInput && model) modelInput.value = model;
    } else {
        console.log('Hardware section not found');
    }
});
</script>

{% endblock %}

{% extends 'base.html' %}
{% load static %}

{# 文字エンコーディングを明示的に指定 #}
<meta charset="UTF-8">

{# タイトルブロックを追加 #}
{% block title %}
    {{ app.title }} の詳細 | アプリギャラリー
{% endblock %}

{# ナビバーを完全に非表示にする #}
{% block navbar %}
{% endblock %}

{% block content %}
<!-- サイバーテーマのCSS読み込み -->
<link rel="stylesheet" href="{% static 'apps_gallery/css/cyber-theme.css' %}">

<!-- サイバーパンク風の装飾 -->
<div class="cyber-background position-fixed w-100 h-100" style="top: 0; left: 0; z-index: -1;">
    <div class="cyber-grid"></div>
</div>

<!-- メインコンテンツ -->
<div id="app-view-detail" class="container-fluid mt-3">
    <!-- ヘッダー -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="cyber-title" style="color: var(--cyber-purple) !important; 
                                     text-shadow: 0 0 10px var(--cyber-purple),
                                                0 0 20px var(--cyber-purple);
                                     font-weight: bold;">
            {{ app.title }}の詳細
        </h2>
    </div>

    <!-- タブナビゲーション -->
    <ul class="nav nav-tabs mb-3 app-tabs" id="appTabs" role="tablist">
        <!-- ホームへ戻るボタン -->
        <li class="nav-item" role="presentation">
            <a href="/" class="nav-link cyber-home" title="ホームへ戻る">
                <span class="fs-4 me-2 cyber-emoji" style="display: inline-block; font-size: 1.5rem;">&#x1F916;</span>
            </a>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link active text-neon" id="screenshots-tab" data-bs-toggle="tab" data-bs-target="#screenshots-section" type="button" role="tab" aria-controls="screenshots-section" aria-selected="true" style="color: var(--cyber-purple) !important; text-shadow: 0 0 10px var(--cyber-purple) !important; border-color: var(--cyber-purple) !important;">スクリーンショット</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link text-neon" id="basic-tab" data-bs-toggle="tab" data-bs-target="#basic-section" type="button" role="tab" aria-controls="basic-section" aria-selected="false" style="color: var(--cyber-gold) !important; text-shadow: 0 0 10px var(--cyber-gold) !important; border-color: var(--cyber-gold) !important;">基本情報</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link text-neon" id="appeal-tab" data-bs-toggle="tab" data-bs-target="#appeal-section" type="button" role="tab" aria-controls="appeal-section" aria-selected="false" style="color: var(--cyber-green) !important; text-shadow: 0 0 10px var(--cyber-green) !important; border-color: var(--cyber-green) !important;">アピール</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link text-neon" id="hardware-tab" data-bs-toggle="tab" data-bs-target="#hardware-section" type="button" role="tab" aria-controls="hardware-section" aria-selected="false" style="color: var(--cyber-blue) !important; text-shadow: 0 0 10px var(--cyber-blue) !important; border-color: var(--cyber-blue) !important;">ハードウェア</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link text-neon" id="dev-env-tab" data-bs-toggle="tab" data-bs-target="#dev-env-section" type="button" role="tab" aria-controls="dev-env-section" aria-selected="false" style="color: var(--cyber-orange) !important; text-shadow: 0 0 10px var(--cyber-orange) !important; border-color: var(--cyber-orange) !important;">開発環境</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link text-neon" id="architecture-tab" data-bs-toggle="tab" data-bs-target="#architecture-section" type="button" role="tab" aria-controls="architecture-section" aria-selected="false" style="color: var(--cyber-lime) !important; text-shadow: 0 0 10px var(--cyber-lime) !important; border-color: var(--cyber-lime) !important;">アーキテクチャ</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link text-neon" id="backend-tab" data-bs-toggle="tab" data-bs-target="#backend-section" type="button" role="tab" aria-controls="backend-section" aria-selected="false" style="color: var(--cyber-aqua) !important; text-shadow: 0 0 10px var(--cyber-aqua) !important; border-color: var(--cyber-aqua) !important;">バックエンド</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link text-neon" id="frontend-tab" data-bs-toggle="tab" data-bs-target="#frontend-section" type="button" role="tab" aria-controls="frontend-section" aria-selected="false" style="color: var(--cyber-pink) !important; text-shadow: 0 0 10px var(--cyber-pink) !important; border-color: var(--cyber-pink) !important;">フロントエンド</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link text-neon" id="database-tab" data-bs-toggle="tab" data-bs-target="#database-section" type="button" role="tab" aria-controls="database-section" aria-selected="false" style="color: var(--cyber-emerald) !important; text-shadow: 0 0 10px var(--cyber-emerald) !important; border-color: var(--cyber-emerald) !important;">データベース</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link text-neon" id="security-tab" data-bs-toggle="tab" data-bs-target="#security-section" type="button" role="tab" aria-controls="security-section" aria-selected="false" style="color: var(--cyber-red) !important; text-shadow: 0 0 10px var(--cyber-red) !important; border-color: var(--cyber-red) !important;">セキュリティ</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link text-neon" id="development-tab" data-bs-toggle="tab" data-bs-target="#development-section" type="button" role="tab" aria-controls="development-section" aria-selected="false" style="color: var(--cyber-yellow) !important; text-shadow: 0 0 10px var(--cyber-yellow) !important; border-color: var(--cyber-yellow) !important;">開発ストーリー</button>
        </li>
    </ul>

    <!-- タブコンテンツ -->
    <div class="tab-content" id="appTabsContent">
        <!-- スクリーンショットタブ -->
        <div class="tab-pane fade show active" id="screenshots-section" role="tabpanel" aria-labelledby="screenshots-tab">
            {% include 'apps_gallery/tabs/01_screenshots_tab.html' %}
        </div>
        
        <!-- 基本情報タブ -->
        <div class="tab-pane fade" id="basic-section" role="tabpanel" aria-labelledby="basic-tab">
            {% include 'apps_gallery/tabs/02_basic_tab.html' %}
        </div>

        <!-- アピールタブ -->
        <div class="tab-pane fade" id="appeal-section" role="tabpanel" aria-labelledby="appeal-tab">
            {% include 'apps_gallery/tabs/03_appeal_tab.html' %}
        </div>

        <!-- ハードウェアタブ -->
        <div class="tab-pane fade" id="hardware-section" role="tabpanel" aria-labelledby="hardware-tab">
            {% include 'apps_gallery/tabs/04_hardware_tab.html' %}
        </div>

        <!-- 開発環境タブ -->
        <div class="tab-pane fade" id="dev-env-section" role="tabpanel" aria-labelledby="dev-env-tab">
            {% include 'apps_gallery/tabs/05_dev_env_tab.html' %}
        </div>

        <!-- アーキテクチャタブ -->
        <div class="tab-pane fade" id="architecture-section" role="tabpanel" aria-labelledby="architecture-tab">
            {% include 'apps_gallery/tabs/06_architecture_tab.html' %}
        </div>

        <!-- バックエンドタブ -->
        <div class="tab-pane fade" id="backend-section" role="tabpanel" aria-labelledby="backend-tab">
            {% include 'apps_gallery/tabs/07_backend_tab.html' %}
        </div>

        <!-- フロントエンドタブ -->
        <div class="tab-pane fade" id="frontend-section" role="tabpanel" aria-labelledby="frontend-tab">
            {% include 'apps_gallery/tabs/08_frontend_tab.html' %}
        </div>

        <!-- データベースタブ -->
        <div class="tab-pane fade" id="database-section" role="tabpanel" aria-labelledby="database-tab">
            {% include 'apps_gallery/tabs/09_database_tab.html' %}
        </div>

        <!-- セキュリティタブ -->
        <div class="tab-pane fade" id="security-section" role="tabpanel" aria-labelledby="security-tab">
            {% include 'apps_gallery/tabs/10_security_tab.html' %}
        </div>

        <!-- 開発ストーリータブ -->
        <div class="tab-pane fade" id="development-section" role="tabpanel" aria-labelledby="development-tab">
            {% include 'apps_gallery/tabs/11_development_tab.html' %}
        </div>
    </div>

    <!-- ホームに戻るボタン -->
    <div class="row mt-4 mb-4">
        <div class="col-md-12 d-flex justify-content-center">
            <a href="/" class="btn btn-secondary cyber-home" id="homeButton">
                <span class="fs-4 me-2 cyber-emoji">&#x1F916;</span> ホームに戻る
            </a>
        </div>
    </div>
</div>

<style>
/* サイバーパンクな背景 */
.cyber-background {
    background: linear-gradient(45deg, #001e54, #0066cc);
}

.cyber-grid {
    background-image: 
        linear-gradient(rgba(0,255,255,0.2) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0,255,255,0.2) 1px, transparent 1px);
    background-size: 20px 20px;
    width: 100%;
    height: 100%;
    animation: gridGlow 4s ease-in-out infinite;
}

@keyframes gridGlow {
    0% { opacity: 0.5; }
    50% { opacity: 0.8; }
    100% { opacity: 0.5; }
}

/* タブナビゲーションの背景 */
.app-tabs {
    background: rgba(13, 25, 45, 0.95) !important;
    backdrop-filter: blur(10px) !important;
    -webkit-backdrop-filter: blur(10px) !important;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
    position: sticky !important;
    top: 0 !important;
    z-index: 1000 !important;
    transition: transform 0.3s ease !important;
    margin-bottom: 2rem !important;  /* タブと下のセクションの間隔を追加 */
}

/* タブのスタイル */
.nav-link {
    transition: all 0.3s ease !important;
    font-weight: bold !important;
    color: inherit !important;
    text-shadow: 0 0 10px currentColor !important;
}

.nav-link:hover {
    transform: translateY(-2px) !important;
    background: rgba(255, 255, 255, 0.1) !important;
}

.nav-link.active {
    background: rgba(255, 255, 255, 0.15) !important;
    box-shadow: 0 0 15px currentColor !important;
}

/* スクロール時のタブ非表示 */
.app-tabs.hidden {
    transform: translateY(-100%) !important;
}

/* ホームボタンのスタイル */
.cyber-home {
    background: linear-gradient(45deg, #2b1055, #7597de) !important;
    border: 1px solid #8ab4f8 !important;
    box-shadow: 0 0 10px #8ab4f8 !important;
    color: white !important;
    transition: all 0.3s ease !important;
}

.cyber-home:hover {
    transform: translateY(-2px) !important;
    box-shadow: 0 0 15px #8ab4f8 !important;
}

/* オリジナルのCSSも維持 */
#app-view-detail {
    margin-top: 1rem !important;
}

/* レスポンシブ対応 */
@media (max-width: 768px) {
    .nav-link {
        padding: 0.5rem 0.3rem !important;
        font-size: 0.9rem !important;
    }
}

@media (max-width: 576px) {
    .nav-link {
        padding: 0.4rem 0.2rem !important;
        font-size: 0.8rem !important;
    }
}
</style>

<!-- タブ制御用スクリプト -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const appTabs = document.querySelector('.app-tabs');
    let lastScrollTop = 0;
    
    window.addEventListener('scroll', function() {
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        
        // 下にスクロールしたらナビを隠す、上にスクロールしたら表示
        if (scrollTop > lastScrollTop && scrollTop > 150) {
            appTabs.classList.add('hidden');
        } else {
            appTabs.classList.remove('hidden');
        }
        
        lastScrollTop = scrollTop;
    });

    // Djangoのメッセージを自動的に閉じる
    const alerts = document.querySelectorAll('.alert');
    if (alerts.length > 0) {
        alerts.forEach(alert => {
            setTimeout(() => {
                // Bootstrapの閉じるボタンをクリックしたのと同じ効果
                const closeBtn = alert.querySelector('.btn-close');
                if (closeBtn) {
                    closeBtn.click();
                } else {
                    // 閉じるボタンがない場合は要素を非表示にする
                    alert.style.opacity = '0';
                    setTimeout(() => {
                        alert.style.display = 'none';
                    }, 300);
                }
            }, 3000); // 3秒後に自動的に閉じる
        });
    }
    
    // ハードウェア情報の展開（既存のコード）
    const hardwareSection = document.getElementById('hardware-section');
    if (hardwareSection) {
        const specs = {
            pc_type: "{{ app.hardware_specs.pc_type|default:'' }}",
            device_type: "{{ app.hardware_specs.device_type|default:'' }}",
            cpu_type: "{{ app.hardware_specs.cpu_type|default:'' }}",
            memory_size: "{{ app.hardware_specs.memory_size|default:'' }}",
            storage_type: "{{ app.hardware_specs.storage_type|default:'' }}",
            monitor_count: "{{ app.hardware_specs.monitor_count|default:'' }}",
            internet_type: "{{ app.hardware_specs.internet_type|default:'' }}"
        };
        
        // 各ラジオボタンの設定
        Object.entries(specs).forEach(([key, value]) => {
            if (!value) return; // 空の値はスキップ
            
            const selector = `input[name="hardware_specs[${key}]"][value="${value}"]`;
            const radioInput = document.querySelector(selector);
            if (radioInput) {
                radioInput.checked = true;
            }
        });

        // メーカーと機種名
        const maker = "{{ app.hardware_specs.maker|default:'' }}";
        const model = "{{ app.hardware_specs.model|default:'' }}";
        
        const makerInput = document.getElementById('maker');
        const modelInput = document.getElementById('model');
        
        if (makerInput && maker) makerInput.value = maker;
        if (modelInput && model) modelInput.value = model;
    }
});
</script>
{% endblock %}
